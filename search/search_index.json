{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#bambu-printer-manager","title":"bambu-printer-manager","text":"<p><code>bambu-printer-manager</code> is an all in one pure python wrapper for interacting with and managing Bambu Lab printers.</p>"},{"location":"#become-a-sponsor","title":"Become a Sponsor","text":"<p>While caffiene and sleepness nights drive the delivery of this project, they unfortunately do not cover the financial expense necessary to further its development.  Please consider becoming a <code>bambu-printer-manager</code> sponsor today!</p>"},{"location":"#project-composition","title":"Project Composition","text":"Text Only<pre><code>bpm/\n    bambucommands.py                # collection of constants mainly representing Bambu Lab `mqtt` request commands\n    bambuconfig.py                  # contains the `BambuConfig` class used for storing configuration data\n    bambuprinter.py                 # the main `bambu-printer-manager` class `BambuPrinter` lives here\n    bambuspool.py                   # contains the `BambuSpool` class used for storing spool data\n    bambustate.py                   # contains the `BambuState` and `AMSUnitState` classes\n    bambutools.py                   # contains a collection of methods used as tools (mostly internal)\n\n    ftpsclient/\n        _client.py              # internal class used for performing `FTPS` operations\n</code></pre>"},{"location":"#dependencies","title":"Dependencies","text":"Text Only<pre><code>Python 3.11+\n\n* mkdocstrings, webcolors and paho-mqtt install automatically as predefined dependencies\n</code></pre>"},{"location":"#installation","title":"Installation","text":"Text Only<pre><code>pip install bambu-printer-manager\n</code></pre>"},{"location":"#imports","title":"Imports","text":"Python<pre><code>from bpm.bambuconfig import BambuConfig\nfrom bpm.bambuprinter import BambuPrinter\nfrom bpm.bambutools import PrinterState\nfrom bpm.bambutools import parseStage\nfrom bpm.bambutools import parseFan\n</code></pre>"},{"location":"#constructors","title":"Constructor(s)","text":"<p>Python<pre><code>config = BambuConfig(hostname=\"{host name}\", access_code=\"{access code}\", serial_number=\"{serial #}\")\nprinter = BambuPrinter(config=config)\n</code></pre> or variations such as: Python<pre><code>config = BambuConfig()\nprinter = BambuPrinter()\n\nconfig.hostname = \"{host name}\"\nconfig.access_code = \"{access code}\"\nconfig.serial_number = \"{serial #}\"\n\nprinter.config = config\n</code></pre> or Python<pre><code>config = BambuConfig()\n\nconfig.hostname = \"{host name}\"\nconfig.access_code = \"{access code}\"\nconfig.serial_number = \"{serial #}\"\n\nprinter = BambuPrinter(config=config)\n</code></pre> or even Python<pre><code>printer = BambuPrinter(config=BambuConfig(hostname=\"{host name}\", access_code=\"{access code}\", serial_number=\"{serial #}\"))\n</code></pre></p>"},{"location":"#future-compatibility","title":"Future Compatibility","text":"<p>This library is evolving and expect to see shifting variables and classes leading up to v1.0.0. Deprecated methods and attributes will be removed upon its release.</p>"},{"location":"#usage-patterns","title":"Usage Patterns","text":"<p>You can either poll <code>BambuPrinter</code> periodically for data updates or rely on a callback when new data becomes available.  The preferred pattern should be callback based, however both of these approaches will work fine.</p> <p>Please consider the examples provided here as mere starting points.</p>"},{"location":"#data-polling-example","title":"Data Polling Example","text":"Python<pre><code>import time\nimport sys\nimport os\n\nfrom bpm.bambuconfig import BambuConfig\nfrom bpm.bambuprinter import BambuPrinter\nfrom bpm.bambutools import PrinterState\n\nhostname = os.getenv('BAMBU_HOSTNAME')\naccess_code = os.getenv('BAMBU_ACCESS_CODE')\nserial_number = os.getenv('BAMBU_SERIAL_NUMBER')\n\nif not hostname or not access_code or not serial_number:\n    print()\n    print(\"BAMBU_HOSTNAME, BAMBU_ACCESS_CODE, and BAMBU_SERIAL_NUMBER environment variables must be set\")\n    print()\n    sys.exit(1)\n\nconfig = BambuConfig(hostname=hostname, access_code=access_code, serial_number=serial_number)\nprinter = BambuPrinter(config=config)\n\nprinter.start_session()\n\nwhile printer.state != PrinterState.CONNECTED:\n    print(\"waiting for bpm to connect to printer\", flush=True)\n    if printer.internalException:\n        print(f\"retrying connection - reason: {printer.internalException if not printer.internalException is None else \"no internal exception\"}\")\n        printer.start_session()\n    time.sleep(1)\n\nprint(\"\\r\\nrefreshing sdcard 3mf files\", flush=True)\nprinter.get_sdcard_3mf_files()\nprint(\"sdcard 3mf files refreshed\\r\\n\", flush=True)\n\nprint(\"bpm is ready for business\\r\\n\")\n\nwhile True:\n    print(f\"tool=[{round(printer.tool_temp, 1)}/{round(printer.tool_temp_target, 1)}] \" +\n          f\"bed=[{round(printer.bed_temp, 1)}/{round(printer.bed_temp_target, 1)}] \" +\n          f\"fan=[{parseFan(printer.fan_speed)}] print=[{printer.gcode_state}] speed=[{printer.speed_level}] \" +\n          f\"light=[{'on' if printer.light_state else 'off'}]\")\n\n    print(f\"stg_cur=[{parseStage(printer.current_stage)}] file=[{printer.gcode_file}] \" +\n          f\"layers=[{printer.layer_count}] layer=[{printer.current_layer}] \" +\n          f\"%=[{printer.percent_complete}] eta=[{printer.time_remaining} min] \" +\n          f\"spool=[{printer.active_spool} ({printer.spool_state})]\")\n\n    time.sleep(1)\n\n@app.route('/api/printer')\ndef get_printer_info():\n    global printer\n    # checking both the spools tuple and recent_update\n    # states ensure we have a healthy data stream\n    if printer.recent_update and printer.spools:\n        return printer.toJson()\n    else:\n        return {\"status\": \"warn\", \"reason\": \"no data to send\"}\n</code></pre>"},{"location":"#callback-pattern","title":"Callback Pattern","text":"Python<pre><code>import sys\nimport os\n\nfrom bpm.bambuconfig import BambuConfig\nfrom bpm.bambuprinter import BambuPrinter\nfrom bpm.bambutools import parseStage\nfrom bpm.bambutools import parseFan\n\nhostname = os.getenv('BAMBU_HOSTNAME')\naccess_code = os.getenv('BAMBU_ACCESS_CODE')\nserial_number = os.getenv('BAMBU_SERIAL_NUMBER')\n\nif not hostname or not access_code or not serial_number:\n    print()\n    print(\"BAMBU_HOSTNAME, BAMBU_ACCESS_CODE, and BAMBU_SERIAL_NUMBER environment variables must be set\")\n    print()\n    sys.exit(1)\n\nconfig = BambuConfig(hostname=hostname, access_code=access_code, serial_number=serial_number)\nprinter = BambuPrinter(config=config)\n\ndef on_update(printer):\n    print(f\"tool=[{round(printer.tool_temp, 1)}/{round(printer.tool_temp_target, 1)}] \" +\n          f\"bed=[{round(printer.bed_temp, 1)}/{round(printer.bed_temp_target, 1)}] \" +\n          f\"fan=[{parseFan(printer.fan_speed)}] print=[{printer.gcode_state}] speed=[{printer.speed_level}] \" +\n          f\"light=[{'on' if printer.light_state else 'off'}]\")\n\n    print(f\"stg_cur=[{parseStage(printer.current_stage)}] file=[{printer.gcode_file}] \" +\n          f\"layers=[{printer.layer_count}] layer=[{printer.current_layer}] \" +\n          f\"%=[{printer.percent_complete}] eta=[{printer.time_remaining} min] \" +\n          f\"spool=[{printer.active_spool} ({printer.spool_state})]\")\n\nprinter.on_update = on_update\nprinter.start_session()\n\n# go do other stuff\n</code></pre>"},{"location":"#cli-w-callback","title":"CLI w/ Callback","text":"Python<pre><code>import json\nimport traceback\nimport time\nimport sys\nimport os\n\nfrom console.utils import wait_key\n\nfrom bpm.bambuconfig import BambuConfig\nfrom bpm.bambuprinter import BambuPrinter\nfrom bpm.bambutools import PrinterState\nfrom bpm.bambutools import parseStage\nfrom bpm.bambutools import parseFan\n\ngcodeState = \"\"\nfirmware = \"N/A\"\nams_firmware = \"N/A\"\n\ndef on_update(printer):\n    global firmware, ams_firmware, gcodeState\n\n    if gcodeState != printer.gcode_state:\n        gcodeState = printer.gcode_state\n\n    if firmware != printer.config.firmware_version:\n        firmware = printer.config.firmware_version\n        print(f\"\\r\\nprinter firmware: [{firmware}] serial #: [{printer.config.serial_number}]\\r\")\n    if ams_firmware != printer.config.ams_firmware_version:\n        ams_firmware = printer.config.ams_firmware_version\n        print(f\"ams firmware: [{ams_firmware}]\\r\")\n\n    print(f\"\\r\\ntool=[{round(printer.tool_temp * 1.0, 1)}/{round(printer.tool_temp_target * 1.0, 1)}] \" +\n         f\"bed=[{round(printer.bed_temp * 1.0, 1)}/{round(printer.bed_temp_target * 1.0, 1)}] \" +\n         f\"fan=[{parseFan(printer.fan_speed)}] print=[{printer.gcode_state}] speed=[{printer.speed_level}] \" +\n         f\"light=[{'on' if printer.light_state else 'off'}]\")\n\n    print(f\"\\rstg_cur=[{parseStage(printer.current_stage)}] file=[{printer.gcode_file}] \" +\n          f\"layers=[{printer.layer_count}] layer=[{printer.current_layer}] \" +\n          f\"%=[{printer.percent_complete}] eta=[{printer.time_remaining} min] \" +\n          f\"spool=[{printer.active_spool} ({printer.spool_state})]\\r\")\n\nprint(\"\\r\")\n\nhostname = os.getenv('BAMBU_HOSTNAME')\naccess_code = os.getenv('BAMBU_ACCESS_CODE')\nserial_number = os.getenv('BAMBU_SERIAL_NUMBER')\n\nif not hostname or not access_code or not serial_number:\n    print()\n    print(\"BAMBU_HOSTNAME, BAMBU_ACCESS_CODE, and BAMBU_SERIAL_NUMBER environment variables must be set\")\n    print()\n    sys.exit(1)\n\nconfig = BambuConfig(hostname=hostname, access_code=access_code, serial_number=serial_number)\nprinter = BambuPrinter(config=config)\n\nprinter.on_update = on_update\nprinter.start_session()\n\ndef confirm(request):\n    printer.pause_session()\n    resp = input(f\"Confirm [{request}] (y/n): \")\n    printer.resume_session()\n    return resp == \"y\" or resp == \"Y\"\n\nspecial = False\n\nwhile True:\n    key = wait_key()\n    if key == \"\\x1b\":\n        special = True\n        continue\n    if special:\n        if key == \"[\": continue\n        if key == \"C\":  # right arrow\n            # client.publish(\"device/{}/request\".format(SERIAL), json.dumps(MOVE_RIGHT))\n            print(\"\\rmove right\\r\")\n        if key == \"D\":  # left arrow\n            # client.publish(\"device/{}/request\".format(SERIAL), json.dumps(MOVE_LEFT))\n            print(\"\\rmove left\\r\")\n        special = False\n        continue\n\n    if not special and key == \"\\r\":\n        print(\"\\r\")\n\n    if key == \"?\":\n        print(\"\\r\\nCommands:\\r\\n\")\n        print(\"   ? = this list\\r\")\n        print(\"   b = bed target temperature\\r\")\n        print(\"   d = dump printer json object\\r\")\n        print(\"   g = send gcode command\\r\")\n        print(\"   f = fan speed (in percent)\\r\")\n        print(\"   l = toggle light\\r\")\n        print(\"   p = print 3MF file\\r\")\n        print(\"   q = quit\\r\")\n        print(\"   Q = restart without exiting\")\n        print(\"   r = request full data refresh\\r\")\n        print(\"   s = change filament / spool\\r\")\n        print(\"   S = change speed (1 to 4)\\r\")\n        print(\"   t = tool target temperature\\r\")\n        print(\"   u = unload filament / spool\\r\")\n        print(\"   v = toggle verbose reporting\\r\")\n        print(\"   w = wifi signal strength\\r\")\n        print(\"   ! = abort job\\r\")\n        print(\"   ~ = toggle subscription\\n\\r\")\n\n    if key == \"d\":\n        print(json.dumps(printer, default=printer.jsonSerializer, indent=4, sort_keys=True).replace(\"\\n\", \"\\r\\n\"))\n\n    if key == \"w\":\n        print(f\"\\r\\nwifi signal strength: [{printer.wifi_signal}]\")\n\n    if key == \"v\":\n        printer.config.verbose = not printer.config.verbose\n\n    if key == \"q\":\n        break\n\n    if key == \"Q\":\n        printer.quit()\n        printer.start_session()\n\n    if key == \"l\":\n        printer.light_state = not printer.light_state\n\n    if key == \"t\":\n        printer.pause_session()\n        temp = input(\"\\r\\nTool0 Target Temperature: \")\n        printer.resume_session()\n        if temp.isnumeric() and confirm(\"CHANGE_TOOL_TEMP\"):\n            printer.tool_temp_target = temp\n\n    if key == \"b\":\n        printer.pause_session()\n        temp = input(\"\\r\\nBed Target Temperature: \")\n        printer.resume_session()\n        if temp.isnumeric():\n            printer.bed_temp_target = temp\n\n    if key == \"f\":\n        printer.pause_session()\n        speed = input(\"\\r\\nFan Speed (%): \")\n        printer.resume_session()\n        if speed.isnumeric():\n            printer.fan_speed = speed\n\n    if key == \"r\":\n        printer.refresh()\n\n    if key == \"u\" and confirm(\"UNLOAD_FILAMENT\"):\n        printer.unload_filament()\n\n    if key == \"s\":\n        printer.pause_session()\n        slot = input(\"\\r\\nTarget Slot: \")\n        printer.resume_session()\n        if len(slot) &gt; 0:\n            printer.load_filament(slot)\n\n    if key == \"g\":\n        printer.pause_session()\n        gcode = input(\"\\r\\nGcode: \")\n        printer.resume_session()\n        if len(gcode) &gt; 0:\n            printer.send_gcode(gcode)\n\n    if key == \"p\":\n        printer.pause_session()\n        name = input(\"\\r\\n3MF filename to print: \")\n        if len(name) &gt; 0:\n            bed = input(\"\\rBed type (1=High Temp Plate, 2=Textured PEI Plate): \")\n            if len(bed) &gt; 0 and bed.isnumeric():\n                ams = \"[{}]\".format(input(\"\\rAMS mapping ([-1/0], [-1/1], [-1/2], [-1/3]): \"))\n                if len(ams) &gt; 0:\n                    printer.resume_session()\n                    printer.print_3mf_file(name, bed, ams)\n                    continue\n        printer.resume_session()\n\n    if key == \"S\":\n        printer.pause_session()\n        speed = input(\"\\r\\nNew speed (1=silent 2=standard 3=sport 4=ludicrous): \")\n        printer.resume_session()\n        if len(speed) &gt; 0 and speed in (\"1\", \"2\", \"3\", \"4\"):\n            printer.speed_level = speed\n\n    if key == \"!\" and confirm(\"STOP\"):\n        printer.stop_printing()\n\n    if key == \"~\":\n        if printer.state == PrinterState.PAUSED:\n            printer.resume_session()\n            print(\"\\rsession resumed\\r\")\n        else:\n            printer.pause_session()\n            print(\"\\rsession paused\\r\")\n\nprinter.quit()\n</code></pre>"},{"location":"container/","title":"bambu-printer-manager Client Container","text":"<p>This container is a Material UI / React application for monitoring and administering Bambu Lab printers.  It runs on an <code>Alpine Linux</code> image with <code>HAPROXY</code> working as a reverse proxy for the frontend, backend, and webcam services.</p> <p>The frontend is written in <code>nodejs</code> and uses the <code>React Material UI</code> library for producing a content rich user experience.  The backend is written in <code>Python</code> and uses a <code>Flask Waitress</code> server for responding to frontend api calls and a custom python library developed specifically for interacting with <code>Bambu Lab</code> printers.</p> <p>The webcam service for A1 and P1 series printers is a custom python daemon that decodes the printer's built-in webcam data and produces a <code>MJPEG</code> stream that is served by the frontend.</p> <p>The video stream for P2/H2/X1 series printers is produced using <code>go2rtc</code> and <code>ffmpeg</code>.</p>"},{"location":"container/#become-a-sponsor","title":"Become a Sponsor","text":"<p>While caffiene and sleepness nights drive the delivery of this project, they unfortunately do not cover the financial expense necessary to further its development.  Please consider becoming a <code>bambu-printer-manager</code> sponsor today!</p>"},{"location":"container/#installation","title":"Installation","text":"Text Only<pre><code># Configure the host, access code, serial #, stream type environment variables and\n# map the NGINX listener to a host port to launch the container\n\ndocker run \\\n       -e BAMBU_HOSTNAME='PRINTER_HOSTNAME_OR_IP' \\\n       -e BAMBU_ACCESS_CODE='PRINTER_ACCESS_CODE' \\\n       -e BAMBU_SERIAL_NUMBER='PRINTER_SERIAL_NUMBER' \\\n       -e BAMBU_VIDEO_STREAM_TYPE='MJPEG or RTSPS' \\\n       -p 80:8080 \\\n       --name bambu-printer-manager synman/bambu-printer-manager\n</code></pre>"},{"location":"container/#usage","title":"Usage","text":"<p>To use <code>bambu-printer-manager</code> you only need to pull the image, configure a couple environment variables, and map the <code>nginx</code> listener (port 8080) to a usable port on the host machine.  You then access it like you would any other web based application.</p> <p> </p> <p> </p>"},{"location":"container/#video-stream","title":"Video Stream","text":"<p>Docker<pre><code>ENV BAMBU_VIDEO_STREAM_TYPE=\"MJPEG-or-RTSPS\"\n</code></pre> You need to set which stream format to use.  The A1 and P1 series require <code>MJPEG</code> and all other machines use <code>RTSPS</code>. If you do not define this variable, the container will default to MJPEG.</p>"},{"location":"container/#external-chamber-heating","title":"External Chamber Heating","text":"<p>This is an <code>advanced</code> feature of the container that allows you to use a heater to control the atmosphere within your printer's enclosure. This is very helpful if you have an A1 in an enclosure and want to use exotic filaments such as ABS, ASA, Polycarbonite, and Nylon.</p> <p>You connect the heater to a Wi-Fi enabled power plug (tplink / tasmota / esphome / tuya / etc) for power delivery and configure the plug to respond to power state commands and power state requests over MQTT.  Some plugs, such as tasmota and esphome flashed one can do this directly while others will likely require something like Home Assistant.</p> <p>You also need a Wi-Fi enabled temperature sensor that can do similar as the Wi-Fi power plug to publish environmental data, specifically the temperature, to an MQTT topic.  The easiest way to do this is to build one yourself.  However, I'm sure there are a number of pre-assembled ones you could use too.</p> <p>The final step is configuring the <code>bambu-printer-manager</code> container to interact with the temperature sensor and power plug: Docker<pre><code>ENV INTEGRATED_EXTERNAL_HEATER=\"TRUE\"\n\nENV CHAMBER_MQTT_HOST=\"MQTT_SERVER_HOST_OR_IP\"\nENV CHAMBER_MQTT_PORT=\"1883\"\nENV CHAMBER_MQTT_USER=\"MQTT_USER_NAME\"\nENV CHAMBER_MQTT_PASS=\"MQTT_PASSWORD\"\nENV CHAMBER_TARGET_TOPIC=\"bambu-printer-manager/chamber_target\"\nENV CHAMBER_TEMPERATURE_TOPIC=\"CHAMBER_TEMPERATURE_TOPIC\"\nENV CHAMBER_REQUESTED_STATE_TOPIC=\"HEATER_REQUESTED_STATE_TOPIC\"\nENV CHAMBER_CURRENT_STATE_TOPIC=\"HEATER_CURRENT_STATE_TOPIC\"\nENV CHAMBER_STATE_ON_VALUE=\"on\"\nENV CHAMBER_STATE_OFF_VALUE=\"off\"\n</code></pre> Once everything is configured properly, you will be able to monitor your chamber's temperature and set a target temperature for it the same way you monitor temperature and set target values for the tool (extruder), the bed, and, the part cooling fan.</p> <p> </p>"},{"location":"container/#troubleshooting","title":"Troubleshooting","text":"<p>If you are geting a <code>port is already in use</code> type error, it is likely because you are trying to run the container using the host's network.  It is recommended that you run the <code>bambu-printer-manager</code> container on a bridged network.  Behind the \"public\" port exposed by HAPROXY (<code>8080</code>), it also requires exclusive access to ports <code>3000</code> (nodejs react frontend), <code>5000</code> (flask waitress backend), and <code>8090</code> (webcamd).  Some hosts, such as Synology DSM use ports like <code>5000</code> and this will cause problems.</p> <p>Verify your printer's information.  You must know its routable IP Address, access code, and serial #. You can find each of these on your printer's display.  These must match your Docker container's applicable environment variable values. Docker<pre><code>ENV BAMBU_HOSTNAME=\"PRINTER_HOST_OR_IP\"\nENV BAMBU_ACCESS_CODE=\"PRINTER_ACCESS_CODE\"\nENV BAMBU_SERIAL_NUMBER=\"PRINTER_SERIAL_NUMBER\"\n</code></pre> So long as the backend api (api/api.py) is running, there a number of useful http endpoints you can call to assist with troubleshooting.</p> <ul> <li> <p><code>http://{container_host_ip}:{container_host_port}/api/health_check</code> - This service route dumps the entire <code>BambuPrinter</code> attribute structure as a <code>json</code> document and adds a general success / failure node at the bottom.</p> </li> <li> <p><code>http://{container_host_ip}:{container_host_port}/api/toggle_verbosity</code> - This service route toggles the underlying log level of all components between <code>WARNING</code> and <code>DEBUG</code>.</p> </li> <li> <p><code>http://{container_host_ip}:{container_host_port}/api/trigger_printer_refresh</code> - This service route requests the printer send full status and version reports.</p> </li> <li> <p><code>http://{container_host_ip}:{container_host_port}/api/dump_log</code> - This service route serves the entire contents of the application log.</p> </li> <li> <p><code>http://{container_host_ip}:{container_host_port}/api/truncate_log</code> - This service route deletes the current application log.  A restart may be required for logging to resume.</p> </li> <li> <p><code>http://{container_host_ip}:{container_host_port}/api/toggle_session</code> - This service route pauses or resumes the <code>BambuPrinter</code> session.  This may be helpful on machines such as the <code>A1</code> where only one client can be connected at a time.</p> </li> </ul> <p>If you encounter an issue you need help with, feel free to open a ticket at GitHub.</p>"},{"location":"license/","title":"License","text":"Text Only<pre><code>            DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE\n                    Version 2, December 2004\n\n Copyright (C) 2004 Sam Hocevar &lt;sam@hocevar.net&gt;\n\n Everyone is permitted to copy and distribute verbatim or modified\n copies of this license document, and changing it is allowed as long\n as the name is changed.\n\n            DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE\n   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION\n\n  0. You just DO WHAT THE FUCK YOU WANT TO.\n</code></pre>"},{"location":"reference/SUMMARY/","title":"SUMMARY","text":"<ul> <li>bpm<ul> <li>bambucommands</li> <li>bambuconfig</li> <li>bambuprinter</li> <li>bambuspool</li> <li>bambustate</li> <li>bambutools</li> <li>ftpsclient<ul> <li>ftpsclient</li> </ul> </li> </ul> </li> </ul>"},{"location":"reference/bpm/__init__/","title":"bpm","text":""},{"location":"reference/bpm/__init__/#bpm","title":"bpm","text":"<p>Modules:</p> Name Description <code>bambucommands</code> <p><code>bambucommands</code> contains all the internal command structures that are used by <code>BambuPrinter</code> to interact</p> <code>bambuconfig</code> <code>bambuprinter</code> <code>bambuspool</code> <code>bambustate</code> <p><code>bambustate</code> provides a unified, thread-safe representation of a Bambu Lab printer's</p> <code>bambutools</code> <code>ftpsclient</code>"},{"location":"reference/bpm/bambucommands/","title":"bambucommands","text":""},{"location":"reference/bpm/bambucommands/#bpm.bambucommands","title":"bambucommands","text":"<p><code>bambucommands</code> contains all the internal command structures that are used by <code>BambuPrinter</code> to interact with your printer.  They are not documented but can be found here.</p>"},{"location":"reference/bpm/bambuconfig/","title":"bambuconfig","text":""},{"location":"reference/bpm/bambuconfig/#bpm.bambuconfig","title":"bambuconfig","text":"<p>Classes:</p> Name Description <code>BambuConfig</code> <p>This is the main configuration class for <code>BambuPrinter</code> and is how it knows where to connect to a printer,</p>"},{"location":"reference/bpm/bambuconfig/#bpm.bambuconfig.BambuConfig","title":"BambuConfig","text":"Python<pre><code>BambuConfig(\n    hostname: str | None = None,\n    access_code: str | None = None,\n    serial_number: str | None = None,\n    mqtt_port: int | None = 8883,\n    mqtt_client_id: str | None = \"studio_client_id:0c1f\",\n    mqtt_username: str | None = \"bblp\",\n    watchdog_timeout: int | None = 30,\n    external_chamber: bool | None = False,\n    verbose: bool | None = False,\n)\n</code></pre> <p>This is the main configuration class for <code>BambuPrinter</code> and is how it knows where to connect to a printer, what access code, and serial # to use. Further, it contains a number of printer behavioral settings that can be changed based on client needs. <code>BambuConfig</code> can also be used to change the log level of <code>bambu-printer-manager</code>'s logging engine.</p>"},{"location":"reference/bpm/bambuconfig/#bpm.bambuconfig.BambuConfig--parameters","title":"Parameters","text":"<ul> <li>hostname : Optional[str] = None</li> <li>access_code : Optional[str] = None</li> <li>serial_number : Optional[str] = None</li> <li>mqtt_port : Optional[int] = 8883</li> <li>mqtt_client_id : Optional[str] = \"studio_client_id:0c1f\"</li> <li>mqtt_username : Optional[str] = \"bblp\"</li> <li>watchdog_timeout : Optional[int] = 30</li> <li>external_chamber : Optional[bool] = False</li> <li>verbose : Optional[bool] = False</li> </ul> <p><code>external_chamber</code> can be used to tell <code>BambuPrinter</code> not to use any of the chamber temperature data received from the printer.  This can be useful if you are using an external chamber temperature sensor / heater and want to inject the sensor value and target temperatures into <code>BambuPrinter</code> directly.</p> <p><code>verbose</code> triggers a global log level change (within the scope of <code>bambu-printer-manager</code>) based on its value.  <code>True</code> will set a log level of <code>DEBUG</code> and <code>False</code> (the default) will set the log level to <code>WARNING</code>.</p>"},{"location":"reference/bpm/bambuconfig/#bpm.bambuconfig.BambuConfig--attributes","title":"Attributes","text":"<ul> <li>All parameters listed above</li> <li>_firmware_version : str - Reported printer firmware version</li> <li>_ams_firmware_version : str - Reported AMS firmware version</li> <li>_printer_model : bambutools.PrinterModel - Model # derived from serial #</li> <li>_auto_recovery : bool - auto recovery from lost steps print option</li> <li>_filament_tangle_detect : bool - detect spool tangles print option</li> <li>_sound_enable : bool - printer speaker print option</li> <li>_auto_switch_filament : bool - AMS auto switch filamement on runout print option</li> <li>_startup_read_option : bool - AMS will automatically read RFID on boot</li> <li>_tray_read_option : bool - AMS will automatically read RFID on tray/spool change</li> <li>_calibrate_remain_flag : bool - AMS will calculate remaining amount of filament in spool (unverified)</li> <li>_buildplate_marker_detector : bool - printer will attempt to validate build plate</li> </ul> Source code in <code>src/bpm/bambuconfig.py</code> Python<pre><code>def __init__(\n    self,\n    hostname: str | None = None,\n    access_code: str | None = None,\n    serial_number: str | None = None,\n    mqtt_port: int | None = 8883,\n    mqtt_client_id: str | None = \"studio_client_id:0c1f\",\n    mqtt_username: str | None = \"bblp\",\n    watchdog_timeout: int | None = 30,\n    external_chamber: bool | None = False,\n    verbose: bool | None = False,\n):\n    \"\"\"\n    Sets up all internal storage attributes for `BambuConfig`.\n\n    Parameters\n    ----------\n    * hostname : Optional[str] = None\n    * access_code : Optional[str] = None\n    * serial_number : Optional[str] = None\n    * mqtt_port : Optional[int] = 8883\n    * mqtt_client_id : Optional[str] = \"studio_client_id:0c1f\"\n    * mqtt_username : Optional[str] = \"bblp\"\n    * watchdog_timeout : Optional[int] = 30\n    * external_chamber : Optional[bool] = False\n    * verbose : Optional[bool] = False\n\n    `external_chamber` can be used to tell `BambuPrinter` not to use any of the chamber\n    temperature data received from the printer.  This can be useful if you are using an\n    external chamber temperature sensor / heater and want to inject the sensor value and\n    target temperatures into `BambuPrinter` directly.\n\n    `verbose` triggers a global log level change (within the scope of `bambu-printer-manager`)\n    based on its value.  `True` will set a log level of `DEBUG` and `False` (the default) will\n    set the log level to `WARNING`.\n\n    Attributes\n    ---------\n    * All parameters listed above\n    * _firmware_version : str - Reported printer firmware version\n    * _ams_firmware_version : str - Reported AMS firmware version\n    * _printer_model : bambutools.PrinterModel - Model # derived from serial #\n    * _auto_recovery : bool - auto recovery from lost steps print option\n    * _filament_tangle_detect : bool - detect spool tangles print option\n    * _sound_enable : bool - printer speaker print option\n    * _auto_switch_filament : bool - AMS auto switch filamement on runout print option\n    * _startup_read_option : bool - AMS will automatically read RFID on boot\n    * _tray_read_option : bool - AMS will automatically read RFID on tray/spool change\n    * _calibrate_remain_flag : bool - AMS will calculate remaining amount of filament in spool (unverified)\n    * _buildplate_marker_detector : bool - printer will attempt to validate build plate\n    \"\"\"\n\n    self._hostname = hostname\n    self._access_code = access_code\n    self.serial_number = serial_number\n    self._mqtt_port = mqtt_port\n    self._mqtt_client_id = mqtt_client_id\n    self._mqtt_username = mqtt_username\n    self._watchdog_timeout = watchdog_timeout\n    self._external_chamber = external_chamber\n    self._verbose = verbose\n\n    self._firmware_version = \"\"\n    self._ams_firmware_version = \"\"\n    self._printer_model = PrinterModel.UNKNOWN\n    self._auto_recovery = True\n    self._filament_tangle_detect = True\n    self._sound_enable = True\n    self._auto_switch_filament = True\n    self._startup_read_option = True\n    self._tray_read_option = True\n    self._calibrate_remain_flag = True\n    self._buildplate_marker_detector = True\n</code></pre>"},{"location":"reference/bpm/bambuprinter/","title":"bambuprinter","text":""},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter","title":"bambuprinter","text":"<p>Classes:</p> Name Description <code>BambuPrinter</code> <p><code>BambuPrinter</code> is the main class within <code>bambu-printer-manager</code></p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter","title":"BambuPrinter","text":"Python<pre><code>BambuPrinter(config: BambuConfig | None = None)\n</code></pre> <p><code>BambuPrinter</code> is the main class within <code>bambu-printer-manager</code> It is responsible for interacting with and managing your Bambu Lab 3d printer. It provides an object oriented abstraction layer between your project and the <code>mqtt</code> and <code>ftps</code> based mechanisms in place for communicating with your printer.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter--parameters","title":"Parameters","text":"<ul> <li>config : Optional[BambuConfig] = None     An optional <code>BambuConfig</code> instance that provides configuration information     for the printer connection.  If not provided, a default <code>BambuConfig</code> instance     will be created.</li> </ul> <p>Methods:</p> Name Description <code>delete_sdcard_file</code> <p>Delete the specified file on the printer's SDCard and returns an updated dict of all files on the printer</p> <code>delete_sdcard_folder</code> <p>Delete the specified folder on the printer's SDCard and returns an updated dict of all files on the printer</p> <code>download_sdcard_file</code> <p>Downloads a file from the printer</p> <code>ftp_connection</code> <p>Opens a connection to the printer's FTP server to support file management.</p> <code>get_current_bind_list</code> <p>Generates the manual_ams_bind list based on current AMS toolhead assignments.</p> <code>get_sdcard_3mf_files</code> <p>Returns a <code>dict</code> (json document) of all <code>.3mf</code> files on the printer's SD card.</p> <code>get_sdcard_contents</code> <p>Returns a <code>dict</code> (json document) of ALL files on the printer's SD card.</p> <code>jsonSerializer</code> <p>Helper method used by <code>toJson()</code> to serialize this object.</p> <code>load_filament</code> <p>Requests the printer to load filament into the extruder using the requested spool (slot #)</p> <code>make_sdcard_directory</code> <p>Creates the specified directory on the printer and returns an updated dict of all files on the printer</p> <code>pause_printing</code> <p>Pauses the current print job if one is running.</p> <code>pause_session</code> <p>Pauses the <code>BambuPrinter</code> session is it is active.  Under the covers this</p> <code>print_3mf_file</code> <p>Submits a request to execute the <code>name</code> 3mf file on the printer's SDCard.</p> <code>quit</code> <p>Shuts down all threads.  Your <code>BambuPrinter</code> instance should probably be</p> <code>refresh</code> <p>Triggers a full data refresh from the printer (if it is connected).  You should use this</p> <code>rename_sdcard_file</code> <p>Renames the specified file on the printer and returns an updated dict of all files on the printer</p> <code>resume_printing</code> <p>Resumes the current print job if one is paused.</p> <code>resume_session</code> <p>Resumes a previously paused session by re-subscribing to the /report topic.</p> <code>sdcard_file_exists</code> <p>Checks to see if a file exists on the printer at the <code>path</code> specified</p> <code>send_ams_control_command</code> <p>Send an AMS Control Command - will pause, resume, or reset the AMS.</p> <code>send_anything</code> <p>puts an arbritary string on the request topic</p> <code>send_gcode</code> <p>Submit one, or more, gcode commands to the printer.  To submit multiple gcode commands, separate them with a newline (\\n) character.</p> <code>set_active_tool</code> <p>sets the current active tool / extruder for machines (H2 series)</p> <code>set_ams_user_setting</code> <p>Enable or disable one of the <code>AMSUserSetting</code> options</p> <code>set_bed_temp_target</code> <p>Sets the bed temperature target.</p> <code>set_buildplate_marker_detector</code> <p>Enables or disables the buildplate_marker_detector</p> <code>set_chamber_temp</code> <p>for printers that do not have managed chambers, this enables you to inject</p> <code>set_chamber_temp_target</code> <p>currently only functional when using an \"external\" chamber heater</p> <code>set_nozzle_details</code> <p>Sets the nozzle details.</p> <code>set_nozzle_temp_target</code> <p>Sets the nozzle temperature target.</p> <code>set_part_cooling_fan_speed_target_percent</code> <p>sets the part cooling fan speed target represented in percent</p> <code>set_print_option</code> <p>Enable or disable one of the <code>PrintOption</code> options</p> <code>set_spool_details</code> <p>Sets spool / tray details such as filament type, color, and nozzle min/max temperature.</p> <code>set_spool_k_factor</code> <p>Sets the linear advance k factor for a specific spool / tray</p> <code>skip_objects</code> <p>skip a list of objects extracted from the 3mf's plate_x.json file</p> <code>start_session</code> <p>Initiates a connection to the Bambu Lab printer and provides a stateful</p> <code>stop_printing</code> <p>Requests the printer to stop printing if a job is currently running.</p> <code>target_spool</code> <code>toJson</code> <p>Returns a <code>dict</code> (json document) representing this object's private class</p> <code>turn_off_ams_dryer</code> <p>Sends a command to the printer to turn off the AMS dryer.</p> <code>turn_on_ams_dryer</code> <p>Sends a command to the printer to turn on the AMS dryer with specified parameters.</p> <code>unload_filament</code> <p>Requests the printer to unload whatever filament / spool may be currently loaded.</p> <code>upload_sdcard_file</code> <p>Uploads the local filesystem file to the printer and returns an updated dict of all files on the printer</p> <p>Attributes:</p> Name Type Description <code>bed_temp</code> <p>returns the current bed temperature</p> <code>bed_temp_target</code> <p>returns or sets the bed temperature target</p> <code>chamber_temp</code> <p>returns or sets the nozzle temperature target</p> <code>chamber_temp_target</code> <p>returns or sets the chamber temperature target</p> <code>fan_speed</code> <p>returns the part fan speed in percent</p> <code>fan_speed_target</code> <p>returns or sets the part cooling fan target speed in percent</p> <code>heatbreak_fan_speed</code> <p>returns the heatbreak fan's current speed in percent</p> <code>on_update</code> <p>sets or returns the callback function that is called when the printer state is updated</p> <code>tool_temp</code> <p>returns or sets the tool temperature</p> <code>tool_temp_target</code> <p>returns or sets the nozzle temperature target</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def __init__(self, config: BambuConfig | None = None):\n    \"\"\"\n    Sets up all internal storage attributes for `BambuPrinter` and bootstraps the\n    logging engine.\n\n    Parameters\n    ----------\n    * config : Optional[BambuConfig] = None\n        An optional `BambuConfig` instance that provides configuration information\n        for the printer connection.  If not provided, a default `BambuConfig` instance\n        will be created.\n    \"\"\"\n    self._mqtt_client_thread = None\n    self._watchdog_thread = None\n\n    self._internalException = None\n    self._lastMessageTime = None\n    self._recent_update = False\n\n    if config is None:\n        config = BambuConfig()\n    self._config = config\n    self._service_state = ServiceState.NO_STATE\n\n    self._client = None\n    self._on_update = None\n\n    self._bed_temp = 0.0\n    self._bed_temp_target = 0.0\n    self._bed_temp_target_time = 0\n\n    self._tool_temp = 0.0\n    self._tool_temp_target = 0.0\n    self._tool_temp_target_time = 0\n\n    self._chamber_temp = 0.0\n    self._chamber_temp_target = 0.0\n    self._chamber_temp_target_time = 0\n\n    self._fan_gear = 0\n    self._heatbreak_fan_speed = 0\n    self._fan_speed = 0\n    self._fan_speed_target = 0\n    self._fan_speed_target_time = 0\n\n    self._light_state = \"\"\n    self._wifi_signal = \"\"\n    self._speed_level = 0\n\n    self._gcode_state = \"\"\n    self._gcode_file = \"\"\n    self._3mf_file = \"\"\n    self._3mf_file_md5 = \"\"\n    self._plate_num = 0\n    self._plate_type = PlateType.NONE\n    self._subtask_name = \"\"\n    self._print_type = \"\"\n    self._percent_complete = 0\n    self._time_remaining = 0\n    self._start_time = 0\n    self._elapsed_time = 0\n    self._layer_count = 0\n    self._current_layer = 0\n\n    self._current_stage = 0\n    self._current_stage_text = \"\"\n\n    self._spools = []\n    self._printer_state = BambuState()\n    self._target_spool = 255\n    self._active_spool = 255\n    self._spool_state = \"\"\n    self._ams_status = None\n    self._ams_exists = False\n    self._ams_rfid_status = None\n\n    self._sdcard_contents = None\n    self._sdcard_3mf_files = None\n\n    self._hms_data = None\n    self._hms_message = \"\"\n    self._last_hms_message = \"\"\n\n    self._print_type = \"\"\n    self._skipped_objects = []\n\n    self._nozzle_type = \"\"\n    self._nozzle_diameter = 0.0\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.bed_temp","title":"bed_temp  <code>property</code>","text":"Python<pre><code>bed_temp\n</code></pre> <p>returns the current bed temperature</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.bed_temp</code> instead.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.bed_temp_target","title":"bed_temp_target  <code>property</code> <code>writable</code>","text":"Python<pre><code>bed_temp_target\n</code></pre> <p>returns or sets the bed temperature target</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.bed_temp_target</code> and <code>set_bed_temp_target</code>.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.chamber_temp","title":"chamber_temp  <code>property</code> <code>writable</code>","text":"Python<pre><code>chamber_temp\n</code></pre> <p>returns or sets the nozzle temperature target</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.chamber_temp</code> and <code>set_chamber_temp</code>.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.chamber_temp_target","title":"chamber_temp_target  <code>property</code> <code>writable</code>","text":"Python<pre><code>chamber_temp_target\n</code></pre> <p>returns or sets the chamber temperature target</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.chamber_temp_target</code> and <code>set_chamber_temp_target</code>.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.fan_speed","title":"fan_speed  <code>property</code>","text":"Python<pre><code>fan_speed\n</code></pre> <p>returns the part fan speed in percent</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.part_cooling_fan_speed_percent</code>.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.fan_speed_target","title":"fan_speed_target  <code>property</code> <code>writable</code>","text":"Python<pre><code>fan_speed_target\n</code></pre> <p>returns or sets the part cooling fan target speed in percent</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.part_cooling_fan_speed_target_percent</code> and <code>set_part_cooling_fan_speed_target_percent</code>.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.heatbreak_fan_speed","title":"heatbreak_fan_speed  <code>property</code>","text":"Python<pre><code>heatbreak_fan_speed\n</code></pre> <p>returns the heatbreak fan's current speed in percent</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.heatbreak_fan_speed_percent</code>.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.on_update","title":"on_update  <code>property</code> <code>writable</code>","text":"Python<pre><code>on_update\n</code></pre> <p>sets or returns the callback function that is called when the printer state is updated</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.on_update--parameters","title":"Parameters","text":"<ul> <li>value : method - (setter) The method to call.</li> </ul>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.tool_temp","title":"tool_temp  <code>property</code>","text":"Python<pre><code>tool_temp\n</code></pre> <p>returns or sets the tool temperature</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.nozzle_temp</code>.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.tool_temp_target","title":"tool_temp_target  <code>property</code> <code>writable</code>","text":"Python<pre><code>tool_temp_target\n</code></pre> <p>returns or sets the nozzle temperature target</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>BambuState.nozzle_temp</code>.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.delete_sdcard_file","title":"delete_sdcard_file","text":"Python<pre><code>delete_sdcard_file(file: str)\n</code></pre> <p>Delete the specified file on the printer's SDCard and returns an updated dict of all files on the printer</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.delete_sdcard_file--parameters","title":"Parameters","text":"<ul> <li>file : str - the full path filename to be deleted</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def delete_sdcard_file(self, file: str):\n    \"\"\"\n    Delete the specified file on the printer's SDCard and returns an updated dict of all files on the printer\n\n    Parameters\n    ----------\n    * file : str - the full path filename to be deleted\n    \"\"\"\n    logger.debug(f\"deleting remote file: [{file}]\")\n\n    with self.ftp_connection() as ftps:\n        ftps.delete_file(file)\n\n    def search_for_and_remove_file(file: str, entry: dict):\n        if \"children\" in entry:\n            entry[\"children\"] = list(\n                filter(lambda i: i[\"id\"] != file, entry[\"children\"])\n            )\n            for child in entry[\"children\"]:\n                search_for_and_remove_file(file, child)\n\n    if self._sdcard_contents:\n        search_for_and_remove_file(file, self._sdcard_contents)\n    if self._sdcard_3mf_files:\n        search_for_and_remove_file(file, self._sdcard_3mf_files)\n\n    logger.debug(f\"delete_sdcard_file - deleted file [{file}] from sdcard\")\n    return self._sdcard_contents\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.delete_sdcard_folder","title":"delete_sdcard_folder","text":"Python<pre><code>delete_sdcard_folder(path: str)\n</code></pre> <p>Delete the specified folder on the printer's SDCard and returns an updated dict of all files on the printer</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.delete_sdcard_folder--parameters","title":"Parameters","text":"<ul> <li>path : str - the full path to folder to be deleted</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def delete_sdcard_folder(self, path: str):\n    \"\"\"\n    Delete the specified folder on the printer's SDCard and returns an updated dict of all files on the printer\n\n    Parameters\n    ----------\n    * path : str - the full path to folder to be deleted\n    \"\"\"\n    logger.debug(f\"delete_sdcard_folder - deleting remote folder: [{path}]\")\n\n    def delete_all_contents(ftps: IoTFTPSClient, path: str):\n        fs = ftps.list_files_ex(path)\n        if fs is not None:\n            for item in fs:\n                if item.is_dir:\n                    delete_all_contents(ftps, item.path)\n                else:\n                    ftps.delete_file(item.path)\n        ftps.delete_folder(path)\n\n    with self.ftp_connection() as ftps:\n        delete_all_contents(ftps, path)\n\n    def search_for_and_remove_folder(path: str, entry: dict):\n        if not path.endswith(\"/\"):\n            path = f\"{path}/\"\n        if \"children\" in entry:\n            entry[\"children\"] = list(\n                filter(lambda i: not i[\"id\"].startswith(path), entry[\"children\"])\n            )\n            for child in entry[\"children\"]:\n                search_for_and_remove_folder(path, child)\n\n    if self._sdcard_contents is not None:\n        search_for_and_remove_folder(path, self._sdcard_contents)\n    if self._sdcard_3mf_files is not None:\n        search_for_and_remove_folder(path, self._sdcard_3mf_files)\n    return self._sdcard_contents\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.download_sdcard_file","title":"download_sdcard_file","text":"Python<pre><code>download_sdcard_file(src: str, dest: str)\n</code></pre> <p>Downloads a file from the printer</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.download_sdcard_file--parameters","title":"Parameters","text":"<ul> <li>src : str - the full path filename on the printer to be downloaded to the host</li> <li>dest : str - the full path filename on the host to store the downloaded file</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def download_sdcard_file(self, src: str, dest: str):\n    \"\"\"\n    Downloads a file from the printer\n\n    Parameters\n    ----------\n    * src : str - the full path filename on the printer to be downloaded to the host\n    * dest : str - the full path filename on the host to store the downloaded file\n    \"\"\"\n    logger.debug(\n        f\"download_sdcard_file - downloading file src: [{src}] dest: [{dest}]\"\n    )\n    with self.ftp_connection() as ftps:\n        ftps.download_file(src, dest)\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.ftp_connection","title":"ftp_connection","text":"Python<pre><code>ftp_connection()\n</code></pre> <p>Opens a connection to the printer's FTP server to support file management.</p> <p>Acts as a context manager, so can be used with the with statement. In that case, the connection will be closed automatically, otherwise the calling code has to make sure to close it again.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>@contextlib.contextmanager\ndef ftp_connection(self):\n    \"\"\"\n    Opens a connection to the printer's FTP server to support file management.\n\n    Acts as a context manager, so can be used with the with statement. In that case,\n    the connection will be closed automatically, otherwise the calling code has to make\n    sure to close it again.\n    \"\"\"\n    ftps = None\n    try:\n        ftps = IoTFTPSClient(\n            self._config.hostname,\n            990,\n            self._config.mqtt_username,\n            self._config.access_code,\n            ssl_implicit=True,\n        )\n        yield ftps\n    finally:\n        if ftps and ftps.ftps_session:\n            ftps.disconnect()\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.get_current_bind_list","title":"get_current_bind_list","text":"Python<pre><code>get_current_bind_list(state: BambuState) -&gt; list[dict[str, Any]]\n</code></pre> <p>Generates the manual_ams_bind list based on current AMS toolhead assignments.</p> <p>This method implements the H2D cross-over hardware targeting: - RIGHT_EXTRUDER (0) -&gt; Hardware Index 1 - LEFT_EXTRUDER (1)  -&gt; Hardware Index 0</p> <p>Includes sentinel placeholder logic for single-AMS configurations to satisfy dual-extruder firmware array requirements.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def get_current_bind_list(self, state: \"BambuState\") -&gt; list[dict[str, Any]]:\n    \"\"\"\n    Generates the manual_ams_bind list based on current AMS toolhead assignments.\n\n    This method implements the H2D cross-over hardware targeting:\n    - RIGHT_EXTRUDER (0) -&gt; Hardware Index 1\n    - LEFT_EXTRUDER (1)  -&gt; Hardware Index 0\n\n    Includes sentinel placeholder logic for single-AMS configurations to satisfy\n    dual-extruder firmware array requirements.\n    \"\"\"\n    bind_list = []\n\n    # 1. Map physical units based on current logical assignments\n    for unit in state.ams_units:\n        # Hardware register inversion logic\n        hw_target = 1 if unit.assigned_to_extruder == ActiveTool.RIGHT_EXTRUDER else 0\n\n        bind_list.append(\n            {\"ams_f_bind\": int(unit.ams_id), \"ams_s_bind\": 0, \"extruder\": hw_target}\n        )\n\n    # 2. Dual-Extruder Array Completeness Requirement\n    # If only one AMS is connected, firmware requires a placeholder for the unused register.\n    if state.ams_connected_count == 1 and len(bind_list) == 1:\n        existing_assignment = bind_list[0]\n\n        # Determine the unassigned hardware register\n        placeholder_hw_target = 0 if existing_assignment[\"extruder\"] == 1 else 1\n\n        # Add sentinel placeholder (Unit ID 1) to complete the dual-path mapping\n        bind_list.append(\n            {\n                \"ams_f_bind\": 1,  # Placeholder Unit ID\n                \"ams_s_bind\": 0,\n                \"extruder\": placeholder_hw_target,\n            }\n        )\n\n    return bind_list\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.get_sdcard_3mf_files","title":"get_sdcard_3mf_files","text":"Python<pre><code>get_sdcard_3mf_files()\n</code></pre> <p>Returns a <code>dict</code> (json document) of all <code>.3mf</code> files on the printer's SD card.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.get_sdcard_3mf_files--usage","title":"Usage","text":"<p>The return value of this method is very useful for binding to things like a clientside <code>TreeView</code></p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def get_sdcard_3mf_files(self):\n    \"\"\"\n    Returns a `dict` (json document) of all `.3mf` files on the printer's SD card.\n\n    Usage\n    -----\n    The return value of this method is very useful for binding to things like a clientside `TreeView`\n    \"\"\"\n    logger.debug(\"get_sdcard_3mf_files - returning sdcard_3mf_files\")\n    return self._sdcard_3mf_files\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.get_sdcard_contents","title":"get_sdcard_contents","text":"Python<pre><code>get_sdcard_contents()\n</code></pre> <p>Returns a <code>dict</code> (json document) of ALL files on the printer's SD card. The private class level <code>_sdcard_contents</code> attribute is also populated.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.get_sdcard_contents--usage","title":"Usage","text":"<p>The return value of this method is very useful for binding to things like a clientside <code>TreeView</code></p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def get_sdcard_contents(self):\n    \"\"\"\n    Returns a `dict` (json document) of ALL files on the printer's SD card.\n    The private class level `_sdcard_contents` attribute is also populated.\n\n    Usage\n    -----\n    The return value of this method is very useful for binding to things like a clientside `TreeView`\n    \"\"\"\n\n    with self.ftp_connection() as ftps:\n        fs = self._get_sftp_files(ftps, \"/\")\n    if fs is None:\n        logger.warning(\"get_sdcard_contents - failed to retrieve files from sdcard\")\n        self._sdcard_contents = None\n        self._sdcard_3mf_files = None\n        return None\n\n    self._sdcard_contents = sortFileTreeAlphabetically(fs)\n\n    def search_for_and_remove_all_other_files(mask: str, entry: dict):\n        if \"children\" in entry:\n            entry[\"children\"] = [\n                x\n                for x in entry[\"children\"]\n                if x[\"id\"].endswith(mask) or \"children\" in x\n            ]\n            for child in entry[\"children\"]:\n                search_for_and_remove_all_other_files(mask, child)\n\n    self._sdcard_3mf_files = json.loads(json.dumps(self._sdcard_contents))\n    search_for_and_remove_all_other_files(\".3mf\", self._sdcard_3mf_files)\n\n    logger.debug(\"get_sdcard_contents - retrieved all files from sdcard\")\n    return fs\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.jsonSerializer","title":"jsonSerializer","text":"Python<pre><code>jsonSerializer(obj)\n</code></pre> <p>Helper method used by <code>toJson()</code> to serialize this object.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def jsonSerializer(self, obj):\n    \"\"\"\n    Helper method used by `toJson()` to serialize this object.\n    \"\"\"\n    try:\n        if isinstance(obj, mqtt.Client) or isinstance(obj, Thread):\n            return \"these are not the droids you are looking for\"\n        if (\n            str(obj.__class__).replace(\"&lt;class '\", \"\").replace(\"'&gt;\", \"\")\n            == \"mappingproxy\"\n        ):\n            return \"this space intentionally left blank\"\n        return obj.__dict__\n    except Exception:\n        logger.warning(\n            f\"jsonSerializer - unable to serialize object - 'obj': [{obj}]\"\n        )\n        return \"not available\"\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.load_filament","title":"load_filament","text":"Python<pre><code>load_filament(slot: int)\n</code></pre> <p>Requests the printer to load filament into the extruder using the requested spool (slot #)</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.load_filament--parameters","title":"Parameters","text":"<p>slot : int</p> <ul> <li><code>0</code> - AMS Spool #1</li> <li><code>1</code> - AMS Spool #2</li> <li><code>2</code> - AMS Spool #3</li> <li><code>3</code> - AMS Spool #4</li> <li><code>254</code> - External Spool</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def load_filament(self, slot: int):\n    \"\"\"\n    Requests the printer to load filament into the extruder using the requested spool (slot #)\n\n    Parameters\n    ----------\n    slot : int\n\n    * `0` - AMS Spool #1\n    * `1` - AMS Spool #2\n    * `2` - AMS Spool #3\n    * `3` - AMS Spool #4\n    * `254` - External Spool\n    \"\"\"\n    # TODO: refactor to support multiple AMSs\n\n    msg = AMS_FILAMENT_CHANGE\n    msg[\"print\"][\"target\"] = int(slot)\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(msg)\n    )\n    logger.debug(\n        f\"load_filament - published AMS_FILAMENT_CHANGE to [device/{self.config.serial_number}/request] - target: [{slot}], bambu_msg: [{msg}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.make_sdcard_directory","title":"make_sdcard_directory","text":"Python<pre><code>make_sdcard_directory(dir: str)\n</code></pre> <p>Creates the specified directory on the printer and returns an updated dict of all files on the printer</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.make_sdcard_directory--parameters","title":"Parameters","text":"<ul> <li>dir : str - the full path directory name to be created</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def make_sdcard_directory(self, dir: str):\n    \"\"\"\n    Creates the specified directory on the printer and returns an updated dict of all files on the printer\n\n    Parameters\n    ----------\n    * dir : str - the full path directory name to be created\n    \"\"\"\n    logger.debug(f\"make_sdcard_directory - creating remote directory [{dir}]\")\n    with self.ftp_connection() as ftps:\n        ftps.mkdir(dir)\n    return self.get_sdcard_contents()\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.pause_printing","title":"pause_printing","text":"Python<pre><code>pause_printing()\n</code></pre> <p>Pauses the current print job if one is running.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def pause_printing(self):\n    \"\"\"\n    Pauses the current print job if one is running.\n    \"\"\"\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\",\n        json.dumps(PAUSE_PRINT),\n    )\n    logger.debug(\n        f\"pause_printing - published PAUSE_PRINT to [device/{self.config.serial_number}/request]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.pause_session","title":"pause_session","text":"Python<pre><code>pause_session()\n</code></pre> <p>Pauses the <code>BambuPrinter</code> session is it is active.  Under the covers this method unsubscribes from the <code>/report</code> topic, essentially disabling all printer data refreshes.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def pause_session(self):\n    \"\"\"\n    Pauses the `BambuPrinter` session is it is active.  Under the covers this\n    method unsubscribes from the `/report` topic, essentially disabling all\n    printer data refreshes.\n    \"\"\"\n    if self.service_state != ServiceState.PAUSED:\n        self.client.unsubscribe(f\"device/{self.config.serial_number}/report\")\n        logger.debug(\n            f\"pause_session - unsubscribed from [device/{self.config.serial_number}/report]\"\n        )\n        self.service_state = ServiceState.PAUSED\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.print_3mf_file","title":"print_3mf_file","text":"Python<pre><code>print_3mf_file(\n    name: str,\n    plate: int,\n    bed: PlateType,\n    use_ams: bool,\n    ams_mapping: str | None = \"\",\n    bedlevel: bool | None = True,\n    flow: bool | None = True,\n    timelapse: bool | None = False,\n)\n</code></pre> <p>Submits a request to execute the <code>name</code> 3mf file on the printer's SDCard.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.print_3mf_file--parameters","title":"Parameters","text":"<ul> <li>name : str                         - path, filename, and extension to execute</li> <li>plate : int                        - the plate # from your slicer to use (usually 1)</li> <li>bed : PlateType                    - the bambutools.PlateType to use</li> <li>use_ams : bool                     - Use the AMS for this print</li> <li>ams_mapping : Optional[str]        - an <code>AMS Mapping</code> that specifies which AMS spools to use (external spool is used if blank)</li> <li>bedlevel : Optional[bool] = True   - boolean value indicates whether or not the printer should auto-level the bed</li> <li>flow : Optional[bool] = True       - boolean value indicates if the printer should perform an extrusion flow calibration</li> <li>timelapse : Optional[bool] = False - boolean value indicates if printer should take timelapse photos during the job</li> </ul>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.print_3mf_file--example","title":"Example","text":"<ul> <li><code>print_3mf_file(\"/jobs/my_project.3mf\", 1, PlateType.HOT_PLATE, False, \"\")</code> - Print the my_project.3mf file in the SDCard /jobs directory using the external spool with bed leveling and extrusion flow calibration enabled and timelapse disabled</li> <li><code>print_3mf_file(\"/jobs/my_project.gcode.3mf\", 1, PlateType.HOT_PLATE, True, \"[-1,-1,2,-1]\")</code> - Same as above but use AMS spool #3</li> </ul>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.print_3mf_file--ams-mapping","title":"AMS Mapping","text":"<ul> <li><code>[0,-1,-1,-1]</code> - use AMS spool #1 only</li> <li><code>[-1,1,-1,-1]</code> - use AMS spool #2 only</li> <li><code>[0,-1,-1,3]</code>  - use AMS spools #1 and #4</li> <li><code>[0,1,2,3]</code>    - use all 4 AMS spools</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def print_3mf_file(\n    self,\n    name: str,\n    plate: int,\n    bed: PlateType,\n    use_ams: bool,\n    ams_mapping: str | None = \"\",\n    bedlevel: bool | None = True,\n    flow: bool | None = True,\n    timelapse: bool | None = False,\n):\n    \"\"\"\n    Submits a request to execute the `name` 3mf file on the printer's SDCard.\n\n    Parameters\n    ----------\n    * name : str                         - path, filename, and extension to execute\n    * plate : int                        - the plate # from your slicer to use (usually 1)\n    * bed : PlateType                    - the bambutools.PlateType to use\n    * use_ams : bool                     - Use the AMS for this print\n    * ams_mapping : Optional[str]        - an `AMS Mapping` that specifies which AMS spools to use (external spool is used if blank)\n    * bedlevel : Optional[bool] = True   - boolean value indicates whether or not the printer should auto-level the bed\n    * flow : Optional[bool] = True       - boolean value indicates if the printer should perform an extrusion flow calibration\n    * timelapse : Optional[bool] = False - boolean value indicates if printer should take timelapse photos during the job\n\n    Example\n    -------\n    * `print_3mf_file(\"/jobs/my_project.3mf\", 1, PlateType.HOT_PLATE, False, \"\")` - Print the my_project.3mf file in the SDCard /jobs directory using the external spool with bed leveling and extrusion flow calibration enabled and timelapse disabled\n    * `print_3mf_file(\"/jobs/my_project.gcode.3mf\", 1, PlateType.HOT_PLATE, True, \"[-1,-1,2,-1]\")` - Same as above but use AMS spool #3\n\n    AMS Mapping\n    -----------\n    * `[0,-1,-1,-1]` - use AMS spool #1 only\n    * `[-1,1,-1,-1]` - use AMS spool #2 only\n    * `[0,-1,-1,3]`  - use AMS spools #1 and #4\n    * `[0,1,2,3]`    - use all 4 AMS spools\n    \"\"\"\n    self._3mf_file = f\"{name}\"\n    self._plate_num = int(plate)\n    self._plate_type = bed\n\n    file = copy.deepcopy(PRINT_3MF_FILE)\n\n    subtask = name[name.rindex(\"/\") + 1 : :] if \"/\" in name else name\n    subtask = (\n        subtask[::-1].replace(\".3mf\"[::-1], \"\", 1)[::-1]\n        if subtask.endswith(\".3mf\")\n        else subtask\n    )\n    subtask = (\n        subtask[::-1].replace(\".gcode\"[::-1], \"\", 1)[::-1]\n        if subtask.endswith(\".gcode\")\n        else subtask\n    )\n\n    file[\"print\"][\"file\"] = self._3mf_file\n    file[\"print\"][\"url\"] = f\"file:///sdcard{self._3mf_file}\"\n    file[\"print\"][\"subtask_name\"] = subtask\n    file[\"print\"][\"bed_type\"] = bed.name.lower()\n    file[\"print\"][\"param\"] = file[\"print\"][\"param\"].replace(\"#\", str(self._plate_num))\n    file[\"print\"][\"use_ams\"] = use_ams\n    if ams_mapping and len(ams_mapping) &gt; 0:\n        file[\"print\"][\"ams_mapping\"] = json.loads(ams_mapping)\n    file[\"print\"][\"bed_leveling\"] = bedlevel\n    file[\"print\"][\"flow_cali\"] = flow\n    file[\"print\"][\"timelapse\"] = timelapse\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(file)\n    )\n    logger.debug(\n        f\"print_3mf_file - published PRINT_3MF_FILE to [device/{self.config.serial_number}/request] print_command: [{file}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.quit","title":"quit","text":"Python<pre><code>quit()\n</code></pre> <p>Shuts down all threads.  Your <code>BambuPrinter</code> instance should probably be considered dead after making this call although you may be able to restart a session with start_session().</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def quit(self):\n    \"\"\"\n    Shuts down all threads.  Your `BambuPrinter` instance should probably be\n    considered dead after making this call although you may be able to restart a\n    session with [start_session](#bpm.bambuprinter.BambuPrinter.start_session)().\n    \"\"\"\n    if self.client and self.client.is_connected():\n        self.client.disconnect()\n        logger.debug(\"quit - mqtt client was connected and is now disconnected\")\n    else:\n        logger.debug(\"quit - mqtt client was already disconnected\")\n\n    self._service_state = ServiceState.QUIT\n    self._notify_update()\n\n    if self._mqtt_client_thread and self._mqtt_client_thread.is_alive():\n        self._mqtt_client_thread.join()\n    if self._watchdog_thread and self._watchdog_thread.is_alive():\n        self._watchdog_thread.join()\n    logger.debug(\"quit - all threads have terminated\")\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.refresh","title":"refresh","text":"Python<pre><code>refresh()\n</code></pre> <p>Triggers a full data refresh from the printer (if it is connected).  You should use this method sparingly as resorting to it indicates something is not working properly.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def refresh(self):\n    \"\"\"\n    Triggers a full data refresh from the printer (if it is connected).  You should use this\n    method sparingly as resorting to it indicates something is not working properly.\n    \"\"\"\n    if self.service_state == ServiceState.CONNECTED:\n        logger.debug(\n            f\"refresh - publishing ANNOUNCE_VERSION to [device/{self.config.serial_number}/request]\"\n        )\n        self.client.publish(\n            f\"device/{self.config.serial_number}/request\",\n            json.dumps(ANNOUNCE_VERSION),\n        )\n        logger.debug(\n            f\"refresh - publishing ANNOUNCE_PUSH to [device/{self.config.serial_number}/request]\"\n        )\n        self.client.publish(\n            f\"device/{self.config.serial_number}/request\",\n            json.dumps(ANNOUNCE_PUSH),\n        )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.rename_sdcard_file","title":"rename_sdcard_file","text":"Python<pre><code>rename_sdcard_file(src: str, dest: str)\n</code></pre> <p>Renames the specified file on the printer and returns an updated dict of all files on the printer</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.rename_sdcard_file--parameters","title":"Parameters","text":"<ul> <li>src : str - the full path name to be renamed</li> <li>dest : str - the full path name to be renamed to</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def rename_sdcard_file(self, src: str, dest: str):\n    \"\"\"\n    Renames the specified file on the printer and returns an updated dict of all files on the printer\n\n    Parameters\n    ----------\n    * src : str - the full path name to be renamed\n    * dest : str - the full path name to be renamed to\n    \"\"\"\n    logger.debug(f\"rename_sdcard_file - renaming printer file [{src}] to [{dest}]\")\n    with self.ftp_connection() as ftps:\n        ftps.move_file(src, dest)\n    return self.get_sdcard_contents()\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.resume_printing","title":"resume_printing","text":"Python<pre><code>resume_printing()\n</code></pre> <p>Resumes the current print job if one is paused.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def resume_printing(self):\n    \"\"\"\n    Resumes the current print job if one is paused.\n    \"\"\"\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\",\n        json.dumps(RESUME_PRINT),\n    )\n    logger.debug(\n        f\"resume_printing - published RESUME_PRINT to [device/{self.config.serial_number}/request]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.resume_session","title":"resume_session","text":"Python<pre><code>resume_session()\n</code></pre> <p>Resumes a previously paused session by re-subscribing to the /report topic.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def resume_session(self):\n    \"\"\"\n    Resumes a previously paused session by re-subscribing to the /report topic.\n    \"\"\"\n    if (\n        self.client\n        and self.client.is_connected()\n        and self.service_state == ServiceState.PAUSED\n    ):\n        self.client.subscribe(f\"device/{self.config.serial_number}/report\")\n        logger.debug(\n            f\"resume_session - subscribed to [device/{self.config.serial_number}/report]\"\n        )\n        self._lastMessageTime = time.monotonic()\n        self.service_state = ServiceState.CONNECTED\n        return\n    self.service_state = ServiceState.QUIT\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.sdcard_file_exists","title":"sdcard_file_exists","text":"Python<pre><code>sdcard_file_exists(path: str) -&gt; bool\n</code></pre> <p>Checks to see if a file exists on the printer at the <code>path</code> specified</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.sdcard_file_exists--parameters","title":"Parameters","text":"<ul> <li>path : str - the full path name to check</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def sdcard_file_exists(self, path: str) -&gt; bool:\n    \"\"\"\n    Checks to see if a file exists on the printer at the `path` specified\n\n    Parameters\n    ----------\n    * path : str - the full path name to check\n    \"\"\"\n    logger.debug(f\"sdcard_file_exists - checking if printer file [{path}] exists\")\n    with self.ftp_connection() as ftps:\n        return ftps.fexists(path)\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.send_ams_control_command","title":"send_ams_control_command","text":"Python<pre><code>send_ams_control_command(ams_control_cmd: AMSControlCommand)\n</code></pre> <p>Send an AMS Control Command - will pause, resume, or reset the AMS.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def send_ams_control_command(self, ams_control_cmd: AMSControlCommand):\n    \"\"\"\n    Send an AMS Control Command - will pause, resume, or reset the AMS.\n    \"\"\"\n    ams_cmd = ams_control_cmd.name.lower()\n    cmd = copy.deepcopy(AMS_CONTROL)\n    cmd[\"print\"][\"param\"] = ams_cmd\n\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"send_ams_control_commandpublished AMS_CONTROL to [device/{self.config.serial_number}/request] bambu_msg: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.send_anything","title":"send_anything","text":"Python<pre><code>send_anything(anything: str)\n</code></pre> <p>puts an arbritary string on the request topic</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def send_anything(self, anything: str):\n    \"\"\"\n    puts an arbritary string on the request topic\n    \"\"\"\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\",\n        json.dumps(json.loads(anything)),\n    )\n    logger.debug(\n        f\"send_anything - published message to [device/{self.config.serial_number}/request] message: [{anything}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.send_gcode","title":"send_gcode","text":"Python<pre><code>send_gcode(gcode: str)\n</code></pre> <p>Submit one, or more, gcode commands to the printer.  To submit multiple gcode commands, separate them with a newline (\\n) character.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.send_gcode--parameters","title":"Parameters","text":"<p>gcode : str</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.send_gcode--examples","title":"Examples","text":"<ul> <li><code>send_gcode(\"G91\\nG0 X0\\nG0 X50\")</code> - queues 3 gcode commands on the printer for processing</li> <li><code>send_gcode(\"G28\")</code> - queues 1 gcode command on the printer for processing</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def send_gcode(self, gcode: str):\n    \"\"\"\n    Submit one, or more, gcode commands to the printer.  To submit multiple gcode commands, separate them with a newline (\\\\n) character.\n\n    Parameters\n    ----------\n    gcode : str\n\n    Examples\n    --------\n    * `send_gcode(\"G91\\\\nG0 X0\\\\nG0 X50\")` - queues 3 gcode commands on the printer for processing\n    * `send_gcode(\"G28\")` - queues 1 gcode command on the printer for processing\n    \"\"\"\n    cmd = copy.deepcopy(SEND_GCODE_TEMPLATE)\n    cmd[\"print\"][\"param\"] = f\"{gcode} \\n\"\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"send_gcode - published SEND_GCODE_TEMPLATE to [device/{self.config.serial_number}/request] gcode: [{gcode}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_active_tool","title":"set_active_tool","text":"Python<pre><code>set_active_tool(id: int)\n</code></pre> <p>sets the current active tool / extruder for machines (H2 series) that have multiple extruders</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_active_tool(self, id: int):\n    \"\"\"\n    sets the current active tool / extruder for machines (H2 series)\n    that have multiple extruders\n    \"\"\"\n    cmd = copy.deepcopy(SET_ACTIVE_TOOL)\n    cmd[\"print\"][\"extruder_index\"] = id\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"set_active_tool - published SET_ACTIVE_TOOL to [device/{self.config.serial_number}/request] command: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_ams_user_setting","title":"set_ams_user_setting","text":"Python<pre><code>set_ams_user_setting(setting: AMSUserSetting, enabled: bool, ams_id: int | None = 0)\n</code></pre> <p>Enable or disable one of the <code>AMSUserSetting</code> options</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_ams_user_setting(\n    self, setting: AMSUserSetting, enabled: bool, ams_id: int | None = 0\n):\n    \"\"\"\n    Enable or disable one of the `AMSUserSetting` options\n    \"\"\"\n    cmd = copy.deepcopy(AMS_USER_SETTING)\n    cmd[\"print\"][\"ams_id\"] = ams_id\n    cmd[\"print\"][AMSUserSetting.CALIBRATE_REMAIN_FLAG.name.lower()] = (\n        self.config.calibrate_remain_flag\n    )\n    cmd[\"print\"][AMSUserSetting.STARTUP_READ_OPTION.name.lower()] = (\n        self.config.startup_read_option\n    )\n    cmd[\"print\"][AMSUserSetting.TRAY_READ_OPTION.name.lower()] = (\n        self.config.tray_read_option\n    )\n\n    cmd[\"print\"][setting.name.lower()] = enabled\n\n    if setting == AMSUserSetting.STARTUP_READ_OPTION:\n        self.config.startup_read_option = enabled\n    elif setting == AMSUserSetting.TRAY_READ_OPTION:\n        self.config.tray_read_option = enabled\n    elif setting == AMSUserSetting.CALIBRATE_REMAIN_FLAG:\n        self.config.calibrate_remain_flag = enabled\n\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"set_ams_user_setting - published AMS_USER_SETTING to [device/{self.config.serial_number}/request] bambu_msg: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_bed_temp_target","title":"set_bed_temp_target","text":"Python<pre><code>set_bed_temp_target(value: float)\n</code></pre> <p>Sets the bed temperature target.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_bed_temp_target--parameters","title":"Parameters","text":"<ul> <li>value : float - The target bed temperature.</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_bed_temp_target(self, value: float):\n    \"\"\"\n    Sets the bed temperature target.\n\n    Parameters\n    ----------\n    * value : float - The target bed temperature.\n    \"\"\"\n    value = float(value)\n    if value &lt; 0.0:\n        value = 0.0\n    gcode = SEND_GCODE_TEMPLATE\n    gcode[\"print\"][\"param\"] = f\"M140 S{value}\\n\"\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(gcode)\n    )\n    self._bed_temp_target_time = round(time.time())\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_buildplate_marker_detector","title":"set_buildplate_marker_detector","text":"Python<pre><code>set_buildplate_marker_detector(enabled: bool)\n</code></pre> <p>Enables or disables the buildplate_marker_detector</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_buildplate_marker_detector(self, enabled: bool):\n    \"\"\"\n    Enables or disables the buildplate_marker_detector\n    \"\"\"\n    cmd = copy.deepcopy(XCAM_CONTROL_SET)\n    cmd[\"xcam\"][\"control\"] = enabled\n    cmd[\"xcam\"][\"enable\"] = enabled\n\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"set_buildplate_marker_detector - published XCAM_CONTROL_SET to [device/{self.config.serial_number}/request] bambu_msg: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_chamber_temp","title":"set_chamber_temp","text":"Python<pre><code>set_chamber_temp(value: float)\n</code></pre> <p>for printers that do not have managed chambers, this enables you to inject a chamber temperature value from an external source</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_chamber_temp--parameters","title":"Parameters","text":"<ul> <li>value : float - The chamber temperature.</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_chamber_temp(self, value: float):\n    \"\"\"\n    for printers that do not have managed chambers, this enables you to inject\n    a chamber temperature value from an external source\n\n    Parameters\n    ----------\n    * value : float - The chamber temperature.\n    \"\"\"\n    self._printer_state.chamber_temp = value\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_chamber_temp_target","title":"set_chamber_temp_target","text":"Python<pre><code>set_chamber_temp_target(value: float)\n</code></pre> <p>currently only functional when using an \"external\" chamber heater</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_chamber_temp_target--parameters","title":"Parameters","text":"<ul> <li>value : float - The target chamber temperature.</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_chamber_temp_target(self, value: float):\n    \"\"\"\n    currently only functional when using an \"external\" chamber heater\n\n    Parameters\n    ----------\n    * value : float - The target chamber temperature.\n    \"\"\"\n    self._printer_state.chamber_temp_target = value\n    self._chamber_temp_target_time = round(time.time())\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_nozzle_details","title":"set_nozzle_details","text":"Python<pre><code>set_nozzle_details(nozzle_diameter: NozzleDiameter, nozzle_type: NozzleType)\n</code></pre> <p>Sets the nozzle details.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_nozzle_details(\n    self, nozzle_diameter: NozzleDiameter, nozzle_type: NozzleType\n):\n    \"\"\"\n    Sets the nozzle details.\n    \"\"\"\n    cmd = copy.deepcopy(SET_ACCESSORIES)\n    cmd[\"system\"][\"nozzle_diameter\"] = nozzle_diameter.value\n    cmd[\"system\"][\"nozzle_type\"] = nozzle_type.name.lower()\n\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"set_nozzle_details - published SET_ACCESSORIES to [device/{self.config.serial_number}/request] bambu_msg: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_nozzle_temp_target","title":"set_nozzle_temp_target","text":"Python<pre><code>set_nozzle_temp_target(value: float, tool_num: int = -1)\n</code></pre> <p>Sets the nozzle temperature target.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_nozzle_temp_target--parameters","title":"Parameters","text":"<ul> <li>value : float - The target nozzle temperature.</li> <li>tool_num : int - The tool number (default is 0).</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_nozzle_temp_target(self, value: float, tool_num: int = -1):\n    \"\"\"\n    Sets the nozzle temperature target.\n\n    Parameters\n    ----------\n    * value : float - The target nozzle temperature.\n    * tool_num : int - The tool number (default is 0).\n    \"\"\"\n    value = float(value)\n    if value &lt; 0.0:\n        value = 0.0\n    gcode = SEND_GCODE_TEMPLATE\n    gcode[\"print\"][\"param\"] = (\n        f\"M104 S{value}{'' if tool_num == -1 else ' T' + str(tool_num)}\\n\"\n    )\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(gcode)\n    )\n    self._tool_temp_target_time = round(time.time())\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_part_cooling_fan_speed_target_percent","title":"set_part_cooling_fan_speed_target_percent","text":"Python<pre><code>set_part_cooling_fan_speed_target_percent(value: int)\n</code></pre> <p>sets the part cooling fan speed target represented in percent</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_part_cooling_fan_speed_target_percent--parameters","title":"Parameters","text":"<ul> <li>value : int - The target speed in percent</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_part_cooling_fan_speed_target_percent(self, value: int):\n    \"\"\"\n    sets the part cooling fan speed target represented in percent\n\n    Parameters\n    ----------\n    * value : int - The target speed in percent\n    \"\"\"\n    if value &lt; 0:\n        value = 0\n    self._printer_state.part_cooling_fan_speed_target_percent = value\n    speed = round(value * 2.55, 0)\n    gcode = SEND_GCODE_TEMPLATE\n    gcode[\"print\"][\"param\"] = (\n        f\"M106 P1 S{speed}\\nM106 P2 S{speed}\\nM106 P3 S{speed}\\n\"\n    )\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(gcode)\n    )\n    self._fan_speed_target_time = round(time.time())\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_print_option","title":"set_print_option","text":"Python<pre><code>set_print_option(option: PrintOption, enabled: bool)\n</code></pre> <p>Enable or disable one of the <code>PrintOption</code> options</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_print_option(self, option: PrintOption, enabled: bool):\n    \"\"\"\n    Enable or disable one of the `PrintOption` options\n    \"\"\"\n    cmd = PRINT_OPTION_COMMAND\n    cmd[\"print\"][option.name.lower()] = \"true\" if enabled else \"false\"\n\n    if option == PrintOption.AUTO_RECOVERY:\n        cmd[\"print\"][\"option\"] = \"1\" if enabled else \"0\"\n        self.config.auto_recovery = enabled\n    elif option == PrintOption.AUTO_SWITCH_FILAMENT:\n        self.config.auto_switch_filament = enabled\n    elif option == PrintOption.FILAMENT_TANGLE_DETECT:\n        self.config.filament_tangle_detect = enabled\n    elif option == PrintOption.SOUND_ENABLE:\n        self.config.sound_enable = enabled\n\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"set_print_option - published PRINT_OPTION_COMMAND to [device/{self.config.serial_number}/request] bambu_msg: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_spool_details","title":"set_spool_details","text":"Python<pre><code>set_spool_details(\n    tray_id: int,\n    tray_info_idx: str,\n    tray_id_name: str | None = \"\",\n    tray_type: str | None = \"\",\n    tray_color: str | None = \"\",\n    nozzle_temp_min: int | None = -1,\n    nozzle_temp_max: int | None = -1,\n)\n</code></pre> <p>Sets spool / tray details such as filament type, color, and nozzle min/max temperature. For the external tray (254), send <code>no_filament</code> as the <code>tray_info_idx</code> value to empty the tray.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_spool_details(\n    self,\n    tray_id: int,\n    tray_info_idx: str,\n    tray_id_name: str | None = \"\",\n    tray_type: str | None = \"\",\n    tray_color: str | None = \"\",\n    nozzle_temp_min: int | None = -1,\n    nozzle_temp_max: int | None = -1,\n):\n    \"\"\"\n    Sets spool / tray details such as filament type, color, and nozzle min/max temperature.\n    For the external tray (254), send `no_filament` as the `tray_info_idx` value to empty the tray.\n    \"\"\"\n    cmd = copy.deepcopy(AMS_FILAMENT_SETTING)\n\n    ams_id = math.floor(tray_id / 4)\n    if tray_id == 254:\n        ams_id = 255\n\n    cmd[\"print\"][\"ams_id\"] = ams_id\n    cmd[\"print\"][\"tray_id\"] = tray_id\n\n    if tray_info_idx == \"no_filament\":\n        tray_info_idx = \"\"\n        tray_id_name = \"\"\n        tray_type = \"\"\n        tray_color = \"FFFFFF00\"\n        nozzle_temp_min = 0\n        nozzle_temp_max = 0\n        cmd[\"print\"][\"setting_id\"] = \"\"\n        cmd[\"print\"][\"slot_id\"] = tray_id\n        cmd[\"print\"][\"tray_type\"] = tray_type\n\n    cmd[\"print\"][\"tray_info_idx\"] = tray_info_idx\n\n    if tray_id_name != \"\":\n        cmd[\"print\"][\"tray_id_name\"] = tray_id_name\n    if tray_type != \"\":\n        cmd[\"print\"][\"tray_type\"] = tray_type\n    if tray_color and tray_color != \"\":\n        color = \"\"\n        try:\n            color = f\"{name_to_hex(tray_color)}FF\".replace(\"#\", \"\").upper()\n        except Exception:\n            color = tray_color\n        cmd[\"print\"][\"tray_color\"] = color\n    if nozzle_temp_min != -1:\n        cmd[\"print\"][\"nozzle_temp_min\"] = nozzle_temp_min\n    if nozzle_temp_max != -1:\n        cmd[\"print\"][\"nozzle_temp_max\"] = nozzle_temp_max\n\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"set_spool_details - published AMS_FILAMENT_SETTING to [device/{self.config.serial_number}/request] bambu_msg: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.set_spool_k_factor","title":"set_spool_k_factor","text":"Python<pre><code>set_spool_k_factor(\n    tray_id: int,\n    k_value: float,\n    n_coef: float | None = 1.399999976158142,\n    nozzle_temp: int | None = -1,\n    bed_temp: int | None = -1,\n    max_volumetric_speed: int | None = -1,\n)\n</code></pre> <p>Sets the linear advance k factor for a specific spool / tray</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def set_spool_k_factor(\n    self,\n    tray_id: int,\n    k_value: float,\n    n_coef: float | None = 1.399999976158142,\n    nozzle_temp: int | None = -1,\n    bed_temp: int | None = -1,\n    max_volumetric_speed: int | None = -1,\n):\n    \"\"\"\n    Sets the linear advance k factor for a specific spool / tray\n    \"\"\"\n    cmd = copy.deepcopy(EXTRUSION_CALI_SET)\n    cmd[\"print\"][\"tray_id\"] = tray_id\n    cmd[\"print\"][\"k_value\"] = k_value\n    cmd[\"print\"][\"n_coef\"] = n_coef\n\n    if nozzle_temp != -1:\n        cmd[\"print\"][\"nozzle_temp\"] = nozzle_temp\n    if bed_temp != -1:\n        cmd[\"print\"][\"bed_temp\"] = bed_temp\n    if max_volumetric_speed != -1:\n        cmd[\"print\"][\"max_volumetric_speed\"] = max_volumetric_speed\n\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"set_spool_k_factor - published EXTRUSION_CALI_SET to [device/{self.config.serial_number}/request] bambu_msg: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.skip_objects","title":"skip_objects","text":"Python<pre><code>skip_objects(objects)\n</code></pre> <p>skip a list of objects extracted from the 3mf's plate_x.json file</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.skip_objects--parameters","title":"Parameters","text":"<p>objects : list</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def skip_objects(self, objects):\n    \"\"\"\n    skip a list of objects extracted from the 3mf's plate_x.json file\n\n    Parameters\n    ----------\n    objects : list\n    \"\"\"\n    objs = []\n    for obj in objects:\n        objs.append(int(obj))\n\n    cmd = copy.deepcopy(SKIP_OBJECTS)\n    cmd[\"print\"][\"obj_list\"] = objs\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n    logger.debug(\n        f\"skip_objects - published SKIP_OBJECTS to [device/{self.config.serial_number}/request] bambu_msg: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.start_session","title":"start_session","text":"Python<pre><code>start_session()\n</code></pre> <p>Initiates a connection to the Bambu Lab printer and provides a stateful session, with built-in recovery in the event <code>BambuPrinter</code> becomes disconnected from the machine.</p> <p>This method is required to be called before any commands or data collection / callbacks can take place with the machine.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def start_session(self):\n    \"\"\"\n    Initiates a connection to the Bambu Lab printer and provides a stateful\n    session, with built-in recovery in the event `BambuPrinter`\n    becomes disconnected from the machine.\n\n    This method is required to be called before any commands or data\n    collection / callbacks can take place with the machine.\n    \"\"\"\n    logger.debug(\"start_session - starting session\")\n    if (\n        self.config.hostname is None\n        or self.config.access_code is None\n        or self.config.serial_number is None\n    ):\n        raise Exception(\"hostname, access_code, and serial_number are required\")\n    if self.client and self.client.is_connected():\n        raise Exception(\"a session is already active\")\n\n    def on_connect(client, userdata, flags, reason_code, properties):\n        logger.debug(\"on_connect - session on_connect\")\n        if self.service_state != ServiceState.PAUSED:\n            self.service_state = ServiceState.CONNECTED\n            client.subscribe(f\"device/{self.config.serial_number}/report\")\n            logger.debug(f\"subscribed to [device/{self.config.serial_number}/report]\")\n\n    def on_disconnect(client, userdata, flags, reason_code, properties):\n        logger.debug(\"on_disconnect - session on_disconnect\")\n        if self._internalException:\n            logger.exception(\"on_disconnect - an internal exception occurred\")\n            self.service_state = ServiceState.QUIT\n            raise self._internalException\n        if self.service_state != ServiceState.PAUSED:\n            self.service_state = ServiceState.DISCONNECTED\n\n    def on_message(client, userdata, msg):\n        logger.debug(f\"on_message - topic: [{msg.topic}]\")\n        if self._lastMessageTime and self._recent_update:\n            self._lastMessageTime = time.monotonic()\n        self._on_message(msg.payload.decode(\"utf-8\"))\n\n    def loop_forever(printer: BambuPrinter):\n        logger.debug(\"loop_forever - starting mqtt loop_forever\")\n        try:\n            printer.client.loop_forever(retry_first_connection=True)\n        except Exception as e:\n            logger.exception(\"loop_forever - an internal exception occurred\")\n            printer._internalException = e\n            if printer.client and printer.client.is_connected():\n                printer.client.disconnect()\n        printer.service_state = ServiceState.QUIT\n\n    self.client = mqtt.Client(mqtt.CallbackAPIVersion.VERSION2)  # type: ignore\n\n    self.client.on_connect = on_connect\n    self.client.on_disconnect = on_disconnect\n    self.client.on_message = on_message\n\n    self.client.tls_set(tls_version=ssl.PROTOCOL_TLS, cert_reqs=ssl.CERT_NONE)\n    self.client.tls_insecure_set(True)\n    self.client.reconnect_delay_set(min_delay=1, max_delay=1)\n\n    self.client.username_pw_set(\n        self.config.mqtt_username, password=self.config.access_code\n    )\n    self.client.user_data_set(self.config.mqtt_client_id)\n\n    try:\n        self.client.connect(self.config.hostname, self.config.mqtt_port, 60)\n    except Exception as e:\n        self._internalException = e\n        logger.warning(\n            f\"start_session - unable to connect to printer - reason: [{e}] stacktrace: [{traceback.format_exc()}]\"\n        )\n        self.service_state = ServiceState.QUIT\n        return\n\n    self._mqtt_client_thread = threading.Thread(\n        target=loop_forever, name=\"bambuprinter-session\", args=(self,)\n    )\n    self._mqtt_client_thread.start()\n\n    self._start_watchdog()\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.stop_printing","title":"stop_printing","text":"Python<pre><code>stop_printing()\n</code></pre> <p>Requests the printer to stop printing if a job is currently running.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def stop_printing(self):\n    \"\"\"\n    Requests the printer to stop printing if a job is currently running.\n    \"\"\"\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\",\n        json.dumps(STOP_PRINT),\n    )\n    logger.debug(\n        f\"stop_printing - published STOP_PRINT to [device/{self.config.serial_number}/request]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.target_spool","title":"target_spool  <code>deprecated</code>","text":"Python<pre><code>target_spool()\n</code></pre> Deprecated <p>This property is deprecated (v1.0.0). Use <code>BambuState.target_tray_id</code>.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>@deprecated(\"This property is deprecated (v1.0.0). Use `BambuState.target_tray_id`.\")\ndef target_spool(self):\n    return self._printer_state.target_tray_id\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.toJson","title":"toJson","text":"Python<pre><code>toJson()\n</code></pre> <p>Returns a <code>dict</code> (json document) representing this object's private class level attributes that are serializable (most are).</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def toJson(self):\n    \"\"\"\n    Returns a `dict` (json document) representing this object's private class\n    level attributes that are serializable (most are).\n    \"\"\"\n    response = json.dumps(self, default=self.jsonSerializer, indent=4, sort_keys=True)\n    # logger.debug(f\"toJson - json: [{response}]\")\n\n    return json.loads(response)\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.turn_off_ams_dryer","title":"turn_off_ams_dryer","text":"Python<pre><code>turn_off_ams_dryer(ams_id: int = 0)\n</code></pre> <p>Sends a command to the printer to turn off the AMS dryer.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def turn_off_ams_dryer(self, ams_id: int = 0):\n    \"\"\"\n    Sends a command to the printer to turn off the AMS dryer.\n    \"\"\"\n    cmd = copy.deepcopy(AMS_FILAMENT_DRYING)\n    cmd[\"print\"][\"ams_id\"] = ams_id\n    cmd[\"print\"][\"mode\"] = 0  # Turn off drying mode\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n\n    ams = self.printer_state.ams_units[ams_id]\n    ams.temp_target = 0\n\n    logger.debug(\n        f\"turn_off_ams_dryer - published AMS_FILAMENT_DRYING to [device/{self.config.serial_number}/request] command: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.turn_on_ams_dryer","title":"turn_on_ams_dryer","text":"Python<pre><code>turn_on_ams_dryer(\n    target_temp: int,\n    duration: int,\n    target_humidity: int = 0,\n    cooling_temp: int = 45,\n    rotate_tray: bool = False,\n    ams_id: int = 0,\n)\n</code></pre> <p>Sends a command to the printer to turn on the AMS dryer with specified parameters.</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.turn_on_ams_dryer--parameters","title":"Parameters","text":"<ul> <li>target_temp : int - The target drying temperature.</li> <li>duration : int - The drying duration in minutes.</li> <li>target_humidity : int - The target humidity level.</li> <li>cooling_temp : int - The cooling temperature after drying (default is 45).</li> <li>rotate_tray : bool - Whether to rotate the tray during drying (default is False).</li> <li>ams_id : int - The AMS ID to control (default is 0).</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def turn_on_ams_dryer(\n    self,\n    target_temp: int,\n    duration: int,\n    target_humidity: int = 0,\n    cooling_temp: int = 45,\n    rotate_tray: bool = False,\n    ams_id: int = 0,\n):\n    \"\"\"\n    Sends a command to the printer to turn on the AMS dryer with specified parameters.\n\n    Parameters\n    ----------\n    * target_temp : int - The target drying temperature.\n    * duration : int - The drying duration in minutes.\n    * target_humidity : int - The target humidity level.\n    * cooling_temp : int - The cooling temperature after drying (default is 45).\n    * rotate_tray : bool - Whether to rotate the tray during drying (default is False).\n    * ams_id : int - The AMS ID to control (default is 0).\n    \"\"\"\n    cmd = copy.deepcopy(AMS_FILAMENT_DRYING)\n    cmd[\"print\"][\"ams_id\"] = ams_id\n    cmd[\"print\"][\"mode\"] = 1  # Turn on drying mode\n    cmd[\"print\"][\"temp\"] = target_temp\n    cmd[\"print\"][\"duration\"] = duration\n    cmd[\"print\"][\"humidity\"] = target_humidity\n    cmd[\"print\"][\"cooling_temp\"] = cooling_temp\n    cmd[\"print\"][\"rotate_tray\"] = rotate_tray\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\", json.dumps(cmd)\n    )\n\n    ams = self.printer_state.ams_units[ams_id]\n    ams.temp_target = target_temp\n\n    logger.debug(\n        f\"turn_on_ams_dryer - published AMS_FILAMENT_DRYING to [device/{self.config.serial_number}/request] command: [{cmd}]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.unload_filament","title":"unload_filament","text":"Python<pre><code>unload_filament()\n</code></pre> <p>Requests the printer to unload whatever filament / spool may be currently loaded.</p> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def unload_filament(self):\n    \"\"\"\n    Requests the printer to unload whatever filament / spool may be currently loaded.\n    \"\"\"\n    self.client.publish(\n        f\"device/{self.config.serial_number}/request\",\n        json.dumps(UNLOAD_FILAMENT),\n    )\n    logger.debug(\n        f\"unload_filament - published UNLOAD_FILAMENT to [device/{self.config.serial_number}/request]\"\n    )\n</code></pre>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.upload_sdcard_file","title":"upload_sdcard_file","text":"Python<pre><code>upload_sdcard_file(src: str, dest: str)\n</code></pre> <p>Uploads the local filesystem file to the printer and returns an updated dict of all files on the printer</p>"},{"location":"reference/bpm/bambuprinter/#bpm.bambuprinter.BambuPrinter.upload_sdcard_file--parameters","title":"Parameters","text":"<ul> <li>src : str - the full path filename on the host to be uploaded to the printer</li> <li>dest : str - the full path filename on the printer to upload to</li> </ul> Source code in <code>src/bpm/bambuprinter.py</code> Python<pre><code>def upload_sdcard_file(self, src: str, dest: str):\n    \"\"\"\n    Uploads the local filesystem file to the printer and returns an updated dict of all files on the printer\n\n    Parameters\n    ----------\n    * src : str - the full path filename on the host to be uploaded to the printer\n    * dest : str - the full path filename on the printer to upload to\n    \"\"\"\n    logger.debug(f\"upload_sdcard_file - uploading file src: [{src}] dest: [{dest}]\")\n    with self.ftp_connection() as ftps:\n        ftps.upload_file(src, dest)\n    return self.get_sdcard_contents()\n</code></pre>"},{"location":"reference/bpm/bambuspool/","title":"bambuspool","text":""},{"location":"reference/bpm/bambuspool/#bpm.bambuspool","title":"bambuspool","text":"<p>Classes:</p> Name Description <code>BambuSpool</code> <p>This value object is used by <code>BambuPrinter</code> to enumerate \"spools\" connected to the printer.</p>"},{"location":"reference/bpm/bambuspool/#bpm.bambuspool.BambuSpool","title":"BambuSpool","text":"Python<pre><code>BambuSpool(\n    id: int,\n    name: str,\n    type: str,\n    sub_brands: str,\n    color: str,\n    tray_info_idx: str,\n    k: float,\n    bed_temp: int,\n    nozzle_temp_min: int,\n    nozzle_temp_max: int,\n    drying_temp: int = 0,\n    drying_time: int = 0,\n    remaining_percent: int = 0,\n    state: int = 0,\n    total_length: int = 0,\n    tray_weight: int = 0,\n)\n</code></pre> <p>This value object is used by <code>BambuPrinter</code> to enumerate \"spools\" connected to the printer. It is used primarily within <code>BambuPrinter</code>'s <code>_spools</code> attribute and is returned as part of a Tuple when there are spools active on machine.</p>"},{"location":"reference/bpm/bambuspool/#bpm.bambuspool.BambuSpool--parameters","title":"Parameters","text":"<ul> <li>id : int - Spool id can be <code>0-3</code> for AMS spools or <code>254</code> for the External spool.</li> <li>name : str - The name of the spool, typically only populated if a Bambu Lab RFID tag is recognized by the AMS.</li> <li>type : str - The type of filament in the spool.  Will either be read by the RFID tag or set on the Printer display.</li> <li>sub_brands : str - For Bambu Lab filaments, specifies the specialization of the filament (Matte, Pro, Tough, etc).</li> <li>color : str - Will either be a color hex code or a color name if <code>webcolors</code> is able to recognize the color code.</li> <li>tray_info_idx : str - The underlying index for the selected filament in Bambu Studio.</li> <li>k : float - The K-Factor to use for determining optimial linear advance (flow rate).</li> <li>bed_temp : int - The target bed temperature to use.</li> <li>nozzle_temp_min : int - The minimum usable nozzle temperature to use.</li> <li>nozzle_temp_max : int - The maximum usable nozzle temperature to use.</li> <li>drying_temp : int - The drying temperature for the filament spool.</li> <li>drying_time : int - The drying time for the filament spool.</li> <li>remaining_percent : int - The estimated remaining filament percentage.</li> <li>state : int - The current state of the spool.</li> <li>total_length : int - The total length of filament on the spool in millimeters.</li> <li>tray_weight : int - The weight of the filament spool in grams.</li> </ul> Source code in <code>src/bpm/bambuspool.py</code> Python<pre><code>def __init__(\n    self,\n    id: int,\n    name: str,\n    type: str,\n    sub_brands: str,\n    color: str,\n    tray_info_idx: str,\n    k: float,\n    bed_temp: int,\n    nozzle_temp_min: int,\n    nozzle_temp_max: int,\n    drying_temp: int = 0,\n    drying_time: int = 0,\n    remaining_percent: int = 0,\n    state: int = 0,\n    total_length: int = 0,\n    tray_weight: int = 0,\n):\n    \"\"\"\n    Sets up all internal storage attributes for `BambuSpool`.\n\n    Parameters\n    ----------\n    * id : int - Spool id can be `0-3` for AMS spools or `254` for the External spool.\n    * name : str - The name of the spool, typically only populated if a Bambu Lab RFID tag is recognized by the AMS.\n    * type : str - The type of filament in the spool.  Will either be read by the RFID tag or set on the Printer display.\n    * sub_brands : str - For Bambu Lab filaments, specifies the specialization of the filament (Matte, Pro, Tough, etc).\n    * color : str - Will either be a color hex code or a color name if `webcolors` is able to recognize the color code.\n    * tray_info_idx : str - The underlying index for the selected filament in Bambu Studio.\n    * k : float - The K-Factor to use for determining optimial linear advance (flow rate).\n    * bed_temp : int - The target bed temperature to use.\n    * nozzle_temp_min : int - The minimum usable nozzle temperature to use.\n    * nozzle_temp_max : int - The maximum usable nozzle temperature to use.\n    * drying_temp : int - The drying temperature for the filament spool.\n    * drying_time : int - The drying time for the filament spool.\n    * remaining_percent : int - The estimated remaining filament percentage.\n    * state : int - The current state of the spool.\n    * total_length : int - The total length of filament on the spool in millimeters.\n    * tray_weight : int - The weight of the filament spool in grams.\n    \"\"\"\n    self.id = id\n    self.name = name\n    self.type = type\n    self.sub_brands = sub_brands\n    self.color = color\n    self.tray_info_idx = tray_info_idx\n    self.k = k\n    self.bed_temp = bed_temp\n    self.nozzle_temp_min = nozzle_temp_min\n    self.nozzle_temp_max = nozzle_temp_max\n    self.drying_temp = drying_temp\n    self.drying_time = drying_time\n    self.remaining_percent = remaining_percent\n    self.state = state\n    self.total_length = total_length\n    self.tray_weight = tray_weight\n</code></pre>"},{"location":"reference/bpm/bambustate/","title":"bambustate","text":""},{"location":"reference/bpm/bambustate/#bpm.bambustate","title":"bambustate","text":"<p><code>bambustate</code> provides a unified, thread-safe representation of a Bambu Lab printer's operational state, synchronized via MQTT telemetry.</p> <p>Classes:</p> Name Description <code>AMSUnitState</code> <p>Detailed state information about an individual AMS unit.</p> <code>BambuState</code> <p>Full representation of the Bambu printer state, synchronized via MQTT telemetry.</p> <code>ExtruderState</code> <p>Detailed state for an individual physical extruder toolhead.</p> <code>PrinterCapabilities</code> <p>Discovery features based on dev_feature_bits and hardware block presence.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState","title":"AMSUnitState  <code>dataclass</code>","text":"Python<pre><code>AMSUnitState(\n    ams_id: str,\n    chip_id: str = \"\",\n    is_ams_lite: bool = False,\n    temp_actual: float = 0.0,\n    temp_target: int = 0,\n    humidity_index: int = 0,\n    humidity_raw: int = 0,\n    is_online: bool = False,\n    is_powered: bool = False,\n    rfid_ready: bool = False,\n    hub_sensor_triggered: bool = False,\n    humidity_sensor_ok: bool = False,\n    heater_on: bool = False,\n    circ_fan_on: bool = False,\n    exhaust_fan_on: bool = False,\n    dry_time: int = 0,\n    is_rotating: bool = False,\n    venting_active: bool = False,\n    high_power_mode: bool = False,\n    hardware_fault: bool = False,\n    tray_exists: list[bool] = (lambda: [False] * 4)(),\n    assigned_to_extruder: ActiveTool = SINGLE_EXTRUDER,\n    drying_stage: AMSDryingStage = IDLE,\n)\n</code></pre> <p>Detailed state information about an individual AMS unit.</p> <p>Attributes:</p> Name Type Description <code>ams_id</code> <code>str</code> <p>Unique physical identifier for the AMS unit.</p> <code>assigned_to_extruder</code> <code>ActiveTool</code> <p>The toolhead currently mapped to this AMS unit (0: Right, 1: Left, 15: Transition).</p> <code>chip_id</code> <code>str</code> <p>Hardware serial or chip ID.</p> <code>circ_fan_on</code> <code>bool</code> <p>True if the internal circulation fan is running.</p> <code>dry_time</code> <code>int</code> <p>Remaining drying time in minutes.</p> <code>drying_stage</code> <code>AMSDryingStage</code> <p>Current stage of the drying cycle (e.g. HEATING, PURGING).</p> <code>exhaust_fan_on</code> <code>bool</code> <p>True if the exhaust fan is running.</p> <code>hardware_fault</code> <code>bool</code> <p>True if a hardware fault bit is set.</p> <code>heater_on</code> <code>bool</code> <p>True if the drying heater is active.</p> <code>high_power_mode</code> <code>bool</code> <p>True if the unit is in performance power mode.</p> <code>hub_sensor_triggered</code> <code>bool</code> <p>True if filament is detected at the AMS hub.</p> <code>humidity_index</code> <code>int</code> <p>Humidity level index (1-5).</p> <code>humidity_raw</code> <code>int</code> <p>Raw humidity sensor value (parsed from telemetry string).</p> <code>humidity_sensor_ok</code> <code>bool</code> <p>True if the humidity sensor is functional.</p> <code>is_ams_lite</code> <code>bool</code> <p>True if this hardware is identified as an AMS Lite.</p> <code>is_online</code> <code>bool</code> <p>True if the unit is communicating with the printer.</p> <code>is_powered</code> <code>bool</code> <p>True if the unit has power.</p> <code>is_rotating</code> <code>bool</code> <p>True if the rollers are currently turning (specifically for drying rotation).</p> <code>rfid_ready</code> <code>bool</code> <p>True if the RFID reader is operational.</p> <code>temp_actual</code> <code>float</code> <p>Current internal temperature of the AMS.</p> <code>temp_target</code> <code>int</code> <p>Target drying temperature.</p> <code>tray_exists</code> <code>list[bool]</code> <p>Presence indicators for the four filament slots.</p> <code>venting_active</code> <code>bool</code> <p>True if the venting mechanism is active.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.ams_id","title":"ams_id  <code>instance-attribute</code>","text":"Python<pre><code>ams_id: str\n</code></pre> <p>Unique physical identifier for the AMS unit.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.assigned_to_extruder","title":"assigned_to_extruder  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>assigned_to_extruder: ActiveTool = SINGLE_EXTRUDER\n</code></pre> <p>The toolhead currently mapped to this AMS unit (0: Right, 1: Left, 15: Transition).</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.chip_id","title":"chip_id  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>chip_id: str = ''\n</code></pre> <p>Hardware serial or chip ID.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.circ_fan_on","title":"circ_fan_on  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>circ_fan_on: bool = False\n</code></pre> <p>True if the internal circulation fan is running.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.dry_time","title":"dry_time  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>dry_time: int = 0\n</code></pre> <p>Remaining drying time in minutes.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.drying_stage","title":"drying_stage  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>drying_stage: AMSDryingStage = IDLE\n</code></pre> <p>Current stage of the drying cycle (e.g. HEATING, PURGING).</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.exhaust_fan_on","title":"exhaust_fan_on  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>exhaust_fan_on: bool = False\n</code></pre> <p>True if the exhaust fan is running.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.hardware_fault","title":"hardware_fault  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>hardware_fault: bool = False\n</code></pre> <p>True if a hardware fault bit is set.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.heater_on","title":"heater_on  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>heater_on: bool = False\n</code></pre> <p>True if the drying heater is active.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.high_power_mode","title":"high_power_mode  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>high_power_mode: bool = False\n</code></pre> <p>True if the unit is in performance power mode.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.hub_sensor_triggered","title":"hub_sensor_triggered  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>hub_sensor_triggered: bool = False\n</code></pre> <p>True if filament is detected at the AMS hub.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.humidity_index","title":"humidity_index  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>humidity_index: int = 0\n</code></pre> <p>Humidity level index (1-5).</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.humidity_raw","title":"humidity_raw  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>humidity_raw: int = 0\n</code></pre> <p>Raw humidity sensor value (parsed from telemetry string).</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.humidity_sensor_ok","title":"humidity_sensor_ok  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>humidity_sensor_ok: bool = False\n</code></pre> <p>True if the humidity sensor is functional.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.is_ams_lite","title":"is_ams_lite  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>is_ams_lite: bool = False\n</code></pre> <p>True if this hardware is identified as an AMS Lite.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.is_online","title":"is_online  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>is_online: bool = False\n</code></pre> <p>True if the unit is communicating with the printer.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.is_powered","title":"is_powered  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>is_powered: bool = False\n</code></pre> <p>True if the unit has power.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.is_rotating","title":"is_rotating  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>is_rotating: bool = False\n</code></pre> <p>True if the rollers are currently turning (specifically for drying rotation).</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.rfid_ready","title":"rfid_ready  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>rfid_ready: bool = False\n</code></pre> <p>True if the RFID reader is operational.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.temp_actual","title":"temp_actual  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>temp_actual: float = 0.0\n</code></pre> <p>Current internal temperature of the AMS.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.temp_target","title":"temp_target  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>temp_target: int = 0\n</code></pre> <p>Target drying temperature.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.tray_exists","title":"tray_exists  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>tray_exists: list[bool] = field(default_factory=lambda: [False] * 4)\n</code></pre> <p>Presence indicators for the four filament slots.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.AMSUnitState.venting_active","title":"venting_active  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>venting_active: bool = False\n</code></pre> <p>True if the venting mechanism is active.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState","title":"BambuState  <code>dataclass</code>","text":"Python<pre><code>BambuState(\n    gcode_state: str = \"IDLE\",\n    current_stage_id: int = 0,\n    current_stage_name: str = \"\",\n    print_percentage: int = 0,\n    remaining_minutes: int = 0,\n    current_layer: int = 0,\n    total_layers: int = 0,\n    active_tray_id: int = 255,\n    active_tray_state: TrayState = UNLOADED,\n    active_tray_state_name: str = name,\n    target_tray_id: int = -1,\n    active_tool: ActiveTool = SINGLE_EXTRUDER,\n    is_external_spool_active: bool = False,\n    active_nozzle_temp: float = 0.0,\n    active_nozzle_temp_target: float = 0.0,\n    bed_temp: float = 0.0,\n    bed_temp_target: float = 0.0,\n    chamber_temp: float = 0.0,\n    chamber_temp_target: float = 0.0,\n    part_cooling_fan_speed_percent: int = 0,\n    part_cooling_fan_speed_target_percent: int = 0,\n    chamber_fan_speed_percent: int = 0,\n    exhaust_fan_speed_percent: int = 0,\n    heatbreak_fan_speed_percent: int = 0,\n    has_active_filtration: bool = False,\n    ams_status_raw: int = 0,\n    ams_status_text: str = \"\",\n    ams_exist_bits: int = 0,\n    ams_connected_count: int = 0,\n    ams_units: list[AMSUnitState] = list(),\n    extruders: list[ExtruderState] = list(),\n    ams_handle_map: dict[int, int] = dict(),\n    print_error: int = 0,\n    hms_errors: list[dict] = list(),\n    capabilities: PrinterCapabilities = PrinterCapabilities(),\n)\n</code></pre> <p>Full representation of the Bambu printer state, synchronized via MQTT telemetry.</p> <p>Methods:</p> Name Description <code>fromJson</code> <p>Parses root MQTT payloads into a unified BambuState with strict hardware gating.</p> <p>Attributes:</p> Name Type Description <code>active_nozzle_temp</code> <code>float</code> <p>Current temperature of the active nozzle.</p> <code>active_nozzle_temp_target</code> <code>float</code> <p>Target temperature of the active nozzle.</p> <code>active_tool</code> <code>ActiveTool</code> <p>The index of the currently active toolhead.</p> <code>active_tray_id</code> <code>int</code> <p>ID of the filament tray currently in use.</p> <code>active_tray_state</code> <code>TrayState</code> <p>Loading status name of the active tray.</p> <code>active_tray_state_name</code> <code>str</code> <p>Loading status of the active tray.</p> <code>ams_connected_count</code> <code>int</code> <p>Total number of detected AMS units.</p> <code>ams_exist_bits</code> <code>int</code> <p>Bitmask indicating which AMS units are connected.</p> <code>ams_handle_map</code> <code>dict[int, int]</code> <p>Mapping of physical AMS indices to logical handles.</p> <code>ams_status_raw</code> <code>int</code> <p>Raw bit-packed status of the AMS system.</p> <code>ams_status_text</code> <code>str</code> <p>Human-readable status of the AMS system.</p> <code>ams_units</code> <code>list[AMSUnitState]</code> <p>Detailed states for each connected AMS unit.</p> <code>bed_temp</code> <code>float</code> <p>Current temperature of the heatbed.</p> <code>bed_temp_target</code> <code>float</code> <p>Target temperature of the heatbed.</p> <code>capabilities</code> <code>PrinterCapabilities</code> <p>Hardware features discovered for the current printer.</p> <code>chamber_fan_speed_percent</code> <code>int</code> <p>Speed of the chamber circulation fan.</p> <code>chamber_temp</code> <code>float</code> <p>Current temperature of the build chamber.</p> <code>chamber_temp_target</code> <code>float</code> <p>Target temperature of the build chamber.</p> <code>current_layer</code> <code>int</code> <p>The layer currently being printed.</p> <code>current_stage_id</code> <code>int</code> <p>Numeric ID of the current print stage.</p> <code>current_stage_name</code> <code>str</code> <p>Human-readable name of the current print stage.</p> <code>exhaust_fan_speed_percent</code> <code>int</code> <p>Speed of the exhaust fan.</p> <code>extruders</code> <code>list[ExtruderState]</code> <p>Detailed states for each physical extruder.</p> <code>gcode_state</code> <code>str</code> <p>Current G-code execution state (e.g., IDLE, RUNNING).</p> <code>has_active_filtration</code> <code>bool</code> <p>True if air filtration is active.</p> <code>heatbreak_fan_speed_percent</code> <code>int</code> <p>Speed of the heatbreak cooling fan.</p> <code>hms_errors</code> <code>list[dict]</code> <p>Consolidated list of all active HMS errors, including the primary print_error.</p> <code>is_external_spool_active</code> <code>bool</code> <p>True if the external spool is being used.</p> <code>part_cooling_fan_speed_percent</code> <code>int</code> <p>Current speed of the part cooling fan.</p> <code>part_cooling_fan_speed_target_percent</code> <code>int</code> <p>Target speed of the part cooling fan.</p> <code>print_error</code> <code>int</code> <p>primary blocking error.</p> <code>print_percentage</code> <code>int</code> <p>Completion percentage of the current print job.</p> <code>remaining_minutes</code> <code>int</code> <p>Estimated remaining time in minutes.</p> <code>target_tray_id</code> <code>int</code> <p>Target tray ID for filament changes.</p> <code>total_layers</code> <code>int</code> <p>The total number of layers in the print job.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.active_nozzle_temp","title":"active_nozzle_temp  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_nozzle_temp: float = 0.0\n</code></pre> <p>Current temperature of the active nozzle.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.active_nozzle_temp_target","title":"active_nozzle_temp_target  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_nozzle_temp_target: float = 0.0\n</code></pre> <p>Target temperature of the active nozzle.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.active_tool","title":"active_tool  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_tool: ActiveTool = SINGLE_EXTRUDER\n</code></pre> <p>The index of the currently active toolhead.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.active_tray_id","title":"active_tray_id  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_tray_id: int = 255\n</code></pre> <p>ID of the filament tray currently in use.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.active_tray_state","title":"active_tray_state  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_tray_state: TrayState = UNLOADED\n</code></pre> <p>Loading status name of the active tray.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.active_tray_state_name","title":"active_tray_state_name  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_tray_state_name: str = name\n</code></pre> <p>Loading status of the active tray.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.ams_connected_count","title":"ams_connected_count  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>ams_connected_count: int = 0\n</code></pre> <p>Total number of detected AMS units.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.ams_exist_bits","title":"ams_exist_bits  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>ams_exist_bits: int = 0\n</code></pre> <p>Bitmask indicating which AMS units are connected.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.ams_handle_map","title":"ams_handle_map  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>ams_handle_map: dict[int, int] = field(default_factory=dict)\n</code></pre> <p>Mapping of physical AMS indices to logical handles.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.ams_status_raw","title":"ams_status_raw  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>ams_status_raw: int = 0\n</code></pre> <p>Raw bit-packed status of the AMS system.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.ams_status_text","title":"ams_status_text  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>ams_status_text: str = ''\n</code></pre> <p>Human-readable status of the AMS system.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.ams_units","title":"ams_units  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>ams_units: list[AMSUnitState] = field(default_factory=list)\n</code></pre> <p>Detailed states for each connected AMS unit.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.bed_temp","title":"bed_temp  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>bed_temp: float = 0.0\n</code></pre> <p>Current temperature of the heatbed.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.bed_temp_target","title":"bed_temp_target  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>bed_temp_target: float = 0.0\n</code></pre> <p>Target temperature of the heatbed.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.capabilities","title":"capabilities  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>capabilities: PrinterCapabilities = field(default_factory=PrinterCapabilities)\n</code></pre> <p>Hardware features discovered for the current printer.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.chamber_fan_speed_percent","title":"chamber_fan_speed_percent  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>chamber_fan_speed_percent: int = 0\n</code></pre> <p>Speed of the chamber circulation fan.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.chamber_temp","title":"chamber_temp  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>chamber_temp: float = 0.0\n</code></pre> <p>Current temperature of the build chamber.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.chamber_temp_target","title":"chamber_temp_target  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>chamber_temp_target: float = 0.0\n</code></pre> <p>Target temperature of the build chamber.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.current_layer","title":"current_layer  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>current_layer: int = 0\n</code></pre> <p>The layer currently being printed.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.current_stage_id","title":"current_stage_id  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>current_stage_id: int = 0\n</code></pre> <p>Numeric ID of the current print stage.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.current_stage_name","title":"current_stage_name  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>current_stage_name: str = ''\n</code></pre> <p>Human-readable name of the current print stage.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.exhaust_fan_speed_percent","title":"exhaust_fan_speed_percent  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>exhaust_fan_speed_percent: int = 0\n</code></pre> <p>Speed of the exhaust fan.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.extruders","title":"extruders  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>extruders: list[ExtruderState] = field(default_factory=list)\n</code></pre> <p>Detailed states for each physical extruder.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.gcode_state","title":"gcode_state  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>gcode_state: str = 'IDLE'\n</code></pre> <p>Current G-code execution state (e.g., IDLE, RUNNING).</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.has_active_filtration","title":"has_active_filtration  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>has_active_filtration: bool = False\n</code></pre> <p>True if air filtration is active.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.heatbreak_fan_speed_percent","title":"heatbreak_fan_speed_percent  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>heatbreak_fan_speed_percent: int = 0\n</code></pre> <p>Speed of the heatbreak cooling fan.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.hms_errors","title":"hms_errors  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>hms_errors: list[dict] = field(default_factory=list)\n</code></pre> <p>Consolidated list of all active HMS errors, including the primary print_error.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.is_external_spool_active","title":"is_external_spool_active  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>is_external_spool_active: bool = False\n</code></pre> <p>True if the external spool is being used.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.part_cooling_fan_speed_percent","title":"part_cooling_fan_speed_percent  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>part_cooling_fan_speed_percent: int = 0\n</code></pre> <p>Current speed of the part cooling fan.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.part_cooling_fan_speed_target_percent","title":"part_cooling_fan_speed_target_percent  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>part_cooling_fan_speed_target_percent: int = 0\n</code></pre> <p>Target speed of the part cooling fan.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.print_error","title":"print_error  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>print_error: int = 0\n</code></pre> <p>primary blocking error.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.print_percentage","title":"print_percentage  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>print_percentage: int = 0\n</code></pre> <p>Completion percentage of the current print job.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.remaining_minutes","title":"remaining_minutes  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>remaining_minutes: int = 0\n</code></pre> <p>Estimated remaining time in minutes.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.target_tray_id","title":"target_tray_id  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>target_tray_id: int = -1\n</code></pre> <p>Target tray ID for filament changes.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.total_layers","title":"total_layers  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>total_layers: int = 0\n</code></pre> <p>The total number of layers in the print job.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.BambuState.fromJson","title":"fromJson  <code>classmethod</code>","text":"Python<pre><code>fromJson(\n    data: dict[str, Any], current_state: Optional[BambuState] = None\n) -&gt; BambuState\n</code></pre> <p>Parses root MQTT payloads into a unified BambuState with strict hardware gating.</p> Source code in <code>src/bpm/bambustate.py</code> Python<pre><code>@classmethod\ndef fromJson(\n    cls, data: dict[str, Any], current_state: Optional[\"BambuState\"] = None\n) -&gt; \"BambuState\":\n    \"\"\"\n    Parses root MQTT payloads into a unified BambuState with strict hardware gating.\n    \"\"\"\n    base = current_state if current_state else cls()\n    info, p = data.get(\"info\", {}), data.get(\"print\", {})\n    ams_root, device = p.get(\"ams\", {}), p.get(\"device\", {})\n    extruder_root = device.get(\"extruder\", {})\n    ctc_root = device.get(\"ctc\", {})\n    modules = info.get(\"module\", [])\n    updates = {}\n\n    # 1. CAPABILITIES &amp; HARDWARE CROSS-VALIDATION\n    feat_bits = info.get(\n        \"dev_feature_bits\", device.get(\"dev_feature_bits\", p.get(\"dev_feature_bits\"))\n    )\n    caps = asdict(base.capabilities)\n    if feat_bits is not None:\n        b = int(feat_bits)\n        caps.update(\n            {\n                \"has_air_filtration\": bool(b &amp; 0x01),\n                \"has_dual_extruder\": bool(b &amp; 0x10),\n                # LiDAR cross-validation: must have bit AND data block presence\n                \"has_lidar\": bool(b &amp; 0x20) and (\"xcam\" in p or \"xcam\" in info),\n                \"has_chamber_temp\": bool(b &amp; 0x40),\n            }\n        )\n\n    # Persistence for status packets\n    if \"ctc\" in device:\n        caps[\"has_chamber_temp\"] = True\n    if \"airduct\" in device:\n        caps[\"has_air_filtration\"] = True\n    if \"ams\" in ams_root or \"ams\" in p:\n        caps[\"has_ams\"] = True\n    if len(extruder_root.get(\"info\", [])) &gt; 1:\n        caps[\"has_dual_extruder\"] = True\n    caps[\"has_camera\"] = True\n    updates[\"capabilities\"] = PrinterCapabilities(**caps)\n\n    # 2. AMS HANDLE MAPPING\n    new_handle_map = base.ams_handle_map.copy()\n    for m in modules:\n        if m.get(\"name\", \"\").startswith(\"n3f/\"):\n            try:\n                idx = int(m[\"name\"].split(\"/\")[-1])\n                if match := re.search(r\"\\((\\d+)\\)\", m.get(\"product_name\", \"\")):\n                    new_handle_map[idx] = int(match.group(1))\n            except (ValueError, IndexError):\n                pass\n    updates[\"ams_handle_map\"] = new_handle_map\n\n    # 3. EXTRUDER TELEMETRY\n    new_extruders = []\n    if \"info\" in extruder_root:\n        for r in extruder_root[\"info\"]:\n            act, tar = unpackTemperature(int(r.get(\"temp\", 0)))\n            new_extruders.append(\n                ExtruderState(\n                    id=int(r.get(\"id\", 0)),\n                    temp=act,\n                    temp_target=tar,\n                    active_tray=(int(r.get(\"snow\", 0)) &gt;&gt; 8) &amp; 0xFF,\n                    slot_id=int(r.get(\"snow\", 0)) &amp; 0xFF,\n                    state=parseExtruderInfo(int(r.get(\"info\", 0))),\n                    status=parseExtruderStatus(int(r.get(\"stat\", 0))),\n                )\n            )\n    updates[\"extruders\"] = new_extruders if new_extruders else base.extruders\n\n    # 4. ACTIVE TOOLHEAD SELECTION\n    if \"state\" in extruder_root:\n        raw_tool_idx = (int(extruder_root[\"state\"]) &gt;&gt; 4) &amp; 0xF\n        # Safe instantiation thanks to ActiveTool.NOT_ACTIVE = 15\n        updates[\"active_tool\"] = (\n            ActiveTool(raw_tool_idx)\n            if updates[\"capabilities\"].has_dual_extruder\n            else ActiveTool.SINGLE_EXTRUDER\n        )\n    else:\n        updates[\"active_tool\"] = base.active_tool\n\n    # 5. AMS UNIT RECONCILIATION\n    cur_ams = {u.ams_id: u for u in base.ams_units}\n    for m in modules:\n        if \"ams\" in m.get(\"name\", \"\") or \"n3f\" in m.get(\"name\", \"\"):\n            ams_id_str = m.get(\"name\", \"\").split(\"/\")[-1]\n            unit = cur_ams.get(ams_id_str, AMSUnitState(ams_id=ams_id_str))\n            unit.chip_id = m.get(\"sn\", unit.chip_id)\n            unit.is_ams_lite = \"lite\" in m.get(\"product_name\", \"\").lower()\n            cur_ams[ams_id_str] = unit\n\n    for r in ams_root.get(\"ams\", []):\n        ams_idx = int(r.get(\"id\", \"0\"))\n        id_s = str(ams_idx)\n        u = cur_ams.get(id_s, AMSUnitState(ams_id=id_s))\n\n        try:\n            if \"humidity_raw\" in r:\n                u.humidity_raw = int(float(r[\"humidity_raw\"]))\n            if \"dry_time\" in r:\n                u.dry_time = int(float(r[\"dry_time\"]))\n            if \"humidity\" in r:\n                u.humidity_index = int(float(r[\"humidity\"]))\n        except (ValueError, TypeError):\n            pass\n\n        u.temp_actual = float(r.get(\"temp\", u.temp_actual))\n\n        if \"info\" in r:\n            p_ams = parseAMSInfo(int(r[\"info\"]))\n            u.is_online, u.is_powered = p_ams[\"is_online\"], p_ams[\"is_powered\"]\n            u.rfid_ready = p_ams[\"rfid_ready\"]\n            u.humidity_sensor_ok = p_ams[\"humidity_sensor_ok\"]\n            u.heater_on, u.is_rotating = p_ams[\"heater_on\"], p_ams[\"is_rotating\"]\n            # Injected: Venting and Drying Stage Logic\n            u.venting_active = p_ams.get(\"venting_active\", False)\n            u.drying_stage = cls._resolve_drying_stage(p_ams, u.dry_time)\n\n            if updates[\"capabilities\"].has_dual_extruder:\n                u.assigned_to_extruder = ActiveTool(\n                    p_ams.get(\"h2d_toolhead_index\", 15)\n                )\n\n        # Bitmask-Based Tray Reconciliation (Nybble Shifting)\n        rb = r.get(\"tray_exist_bits\", ams_root.get(\"tray_exist_bits\"))\n        if rb is not None:\n            eb = int(rb, 16) if isinstance(rb, str) else int(rb)\n            u.tray_exists = [bool((eb &gt;&gt; (4 * ams_idx)) &amp; (1 &lt;&lt; j)) for j in range(4)]\n        cur_ams[id_s] = u\n\n    updates[\"ams_units\"] = list(cur_ams.values())\n\n    # 6. THERMAL &amp; TRAY HANDOFF\n\n    # 6.1 Standard Thermal Sensors\n    updates[\"bed_temp\"] = float(p.get(\"bed_temper\", base.bed_temp))\n    updates[\"bed_temp_target\"] = float(\n        p.get(\"bed_target_temper\", base.bed_temp_target)\n    )\n\n    if ctc_root:\n        updates[\"chamber_temp\"] = float(\n            ctc_root.get(\"info\", {}).get(\"temp\", base.chamber_temp)\n        )\n        updates[\"chamber_temp_target\"] = base.chamber_temp_target\n\n    # 6.3 Target Tray Translation (Gated by Stage)\n    current_stage = int(p.get(\"stg_cur\", base.current_stage_id))\n    raw_tar_val = int(ams_root.get(\"tray_tar\", p.get(\"tray_tar\", 255)))\n\n    if current_stage != 24:\n        updates[\"target_tray_id\"] = -1\n    elif raw_tar_val == 255:\n        updates[\"target_tray_id\"] = -1\n    elif raw_tar_val == 254 and updates[\"capabilities\"].has_dual_extruder:\n        tool_idx = updates.get(\"active_tool\", base.active_tool).value\n        updates[\"target_tray_id\"] = 254 + (1 if tool_idx == 0 else 0)\n    else:\n        updates[\"target_tray_id\"] = raw_tar_val\n\n    # 6.4 Active Extruder State Handoff\n    a_ext = next(\n        (\n            e\n            for e in updates[\"extruders\"]\n            if e.id == updates.get(\"active_tool\", base.active_tool).value\n        ),\n        None,\n    )\n\n    if (\n        a_ext\n        and updates.get(\"active_tool\", base.active_tool) != ActiveTool.NOT_ACTIVE\n    ):\n        updates[\"active_nozzle_temp\"], updates[\"active_nozzle_temp_target\"] = (\n            a_ext.temp,\n            a_ext.temp_target,\n        )\n\n        if a_ext.active_tray != 0:\n            if a_ext.active_tray &gt;= 254:\n                updates[\"active_tray_id\"] = a_ext.active_tray\n            else:\n                updates[\"active_tray_id\"] = (\n                    (a_ext.active_tray - 1) &lt;&lt; 2\n                ) | a_ext.slot_id\n\n            updates[\"active_tray_state\"] = (\n                TrayState.LOADED\n                if a_ext.state == ExtruderInfoState.LOADED\n                else TrayState.UNLOADED\n            )\n\n    else:\n        updates[\"active_nozzle_temp\"] = float(\n            p.get(\"nozzle_temper\", base.active_nozzle_temp)\n        )\n        updates[\"active_nozzle_temp_target\"] = float(\n            p.get(\"nozzle_target_temper\", base.active_nozzle_temp_target)\n        )\n        updates[\"active_tray_id\"] = int(ams_root.get(\"tray_now\", base.active_tray_id))\n        if updates[\"active_tray_id\"] == 255:\n            updates[\"active_tray_id\"] = -1\n        updates[\"active_tray_state\"] = (\n            TrayState.UNLOADED\n            if updates[\"active_tray_id\"] == -1\n            else TrayState.LOADED\n        )\n\n    updates[\"active_tray_state_name\"] = updates[\"active_tray_state\"].name\n\n    if updates[\"target_tray_id\"] == -1 and current_stage != 22:\n        updates[\"target_tray_id\"] = updates[\"active_tray_id\"]\n\n    # 7. GLOBAL METADATA &amp; FANS\n    raw_exist = ams_root.get(\"ams_exist_bits\", base.ams_exist_bits)\n    updates[\"ams_exist_bits\"] = (\n        int(raw_exist, 16) if isinstance(raw_exist, str) else int(raw_exist)\n    )\n    updates[\"ams_connected_count\"] = bin(updates[\"ams_exist_bits\"]).count(\"1\")\n    updates[\"ams_status_raw\"] = int(p.get(\"ams_status\", base.ams_status_raw))\n    updates[\"ams_status_text\"] = parseAMSStatus(updates[\"ams_status_raw\"])\n    updates[\"gcode_state\"] = p.get(\"gcode_state\", base.gcode_state)\n    updates[\"current_stage_id\"] = current_stage\n    updates[\"current_stage_name\"] = parseStage(current_stage)\n\n    # 8. ERROR HANDLING\n    updates[\"print_error\"] = int(p.get(\"print_error\", base.print_error))\n\n    decoded_error = {}\n    if updates[\"print_error\"] != 0:\n        decoded_error = decodeError(updates[\"print_error\"])\n\n    # decodeHMS handles only the hms list segment\n    updates[\"hms_errors\"] = decodeHMS(\n        p.get(\"hms\", base.hms_errors if \"hms\" not in p else [])\n    )\n\n    if decoded_error and decoded_error not in updates[\"hms_errors\"]:\n        updates[\"hms_errors\"].insert(0, decoded_error)\n\n    # 9. FAN SPEEDS &amp; FILTRATION\n    updates[\"part_cooling_fan_speed_percent\"] = scaleFanSpeed(\n        p.get(\"cooling_fan_speed\", 0)\n    )\n    updates[\"part_cooling_fan_speed_target_percent\"] = scaleFanSpeed(\n        p.get(\"cooling_fan_target_speed\", base.part_cooling_fan_speed_target_percent)\n    )\n    updates[\"heatbreak_fan_speed_percent\"] = scaleFanSpeed(\n        p.get(\"heatbreak_fan_speed\", base.heatbreak_fan_speed_percent)\n    )\n    updates[\"exhaust_fan_speed_percent\"] = scaleFanSpeed(p.get(\"big_fan2_speed\", 0))\n    updates[\"chamber_fan_speed_percent\"] = scaleFanSpeed(\n        p.get(\"big_fan1_speed\", base.chamber_fan_speed_percent)\n    )\n    updates[\"has_active_filtration\"] = (\n        updates[\"capabilities\"].has_air_filtration\n        and updates[\"exhaust_fan_speed_percent\"] &gt; 0\n    )\n\n    return replace(base, **updates)\n</code></pre>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState","title":"ExtruderState  <code>dataclass</code>","text":"Python<pre><code>ExtruderState(\n    id: int = 0,\n    temp: float = 0.0,\n    temp_target: float = 0.0,\n    info_bits: int = 0,\n    state: ExtruderInfoState = NO_NOZZLE,\n    status: ExtruderStatus = IDLE,\n    active_tray: int = 255,\n    slot_id: int = 255,\n)\n</code></pre> <p>Detailed state for an individual physical extruder toolhead.</p> <p>Attributes:</p> Name Type Description <code>active_tray</code> <code>int</code> <p>Physical Source ID currently feeding this extruder.</p> <code>id</code> <code>int</code> <p>Physical ID of the extruder (0: Right, 1: Left).</p> <code>info_bits</code> <code>int</code> <p>Raw bitmask for filament and nozzle detection.</p> <code>slot_id</code> <code>int</code> <p>Physical AMS slot currently feeding this extruder.</p> <code>state</code> <code>ExtruderInfoState</code> <p>Human-readable filament/nozzle status.</p> <code>status</code> <code>ExtruderStatus</code> <p>Human-readable operational state.</p> <code>temp</code> <code>float</code> <p>Current nozzle temperature in Celsius.</p> <code>temp_target</code> <code>float</code> <p>Target nozzle temperature in Celsius.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState.active_tray","title":"active_tray  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>active_tray: int = 255\n</code></pre> <p>Physical Source ID currently feeding this extruder.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState.id","title":"id  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>id: int = 0\n</code></pre> <p>Physical ID of the extruder (0: Right, 1: Left).</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState.info_bits","title":"info_bits  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>info_bits: int = 0\n</code></pre> <p>Raw bitmask for filament and nozzle detection.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState.slot_id","title":"slot_id  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>slot_id: int = 255\n</code></pre> <p>Physical AMS slot currently feeding this extruder.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState.state","title":"state  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>state: ExtruderInfoState = NO_NOZZLE\n</code></pre> <p>Human-readable filament/nozzle status.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState.status","title":"status  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>status: ExtruderStatus = IDLE\n</code></pre> <p>Human-readable operational state.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState.temp","title":"temp  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>temp: float = 0.0\n</code></pre> <p>Current nozzle temperature in Celsius.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.ExtruderState.temp_target","title":"temp_target  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>temp_target: float = 0.0\n</code></pre> <p>Target nozzle temperature in Celsius.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.PrinterCapabilities","title":"PrinterCapabilities  <code>dataclass</code>","text":"Python<pre><code>PrinterCapabilities(\n    has_ams: bool = False,\n    has_lidar: bool = False,\n    has_camera: bool = False,\n    has_dual_extruder: bool = False,\n    has_air_filtration: bool = False,\n    has_chamber_temp: bool = False,\n)\n</code></pre> <p>Discovery features based on dev_feature_bits and hardware block presence.</p> <p>Attributes:</p> Name Type Description <code>has_air_filtration</code> <code>bool</code> <p>True if the printer supports active air filtration.</p> <code>has_ams</code> <code>bool</code> <p>True if an AMS unit is supported or detected.</p> <code>has_camera</code> <code>bool</code> <p>True if the printer has an internal camera.</p> <code>has_chamber_temp</code> <code>bool</code> <p>True if the printer has a dedicated chamber temperature sensor.</p> <code>has_dual_extruder</code> <code>bool</code> <p>True if the printer is an H2D (Dual Extruder) architecture.</p> <code>has_lidar</code> <code>bool</code> <p>True if the printer has a LiDAR sensor (verified against xcam presence).</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.PrinterCapabilities.has_air_filtration","title":"has_air_filtration  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>has_air_filtration: bool = False\n</code></pre> <p>True if the printer supports active air filtration.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.PrinterCapabilities.has_ams","title":"has_ams  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>has_ams: bool = False\n</code></pre> <p>True if an AMS unit is supported or detected.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.PrinterCapabilities.has_camera","title":"has_camera  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>has_camera: bool = False\n</code></pre> <p>True if the printer has an internal camera.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.PrinterCapabilities.has_chamber_temp","title":"has_chamber_temp  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>has_chamber_temp: bool = False\n</code></pre> <p>True if the printer has a dedicated chamber temperature sensor.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.PrinterCapabilities.has_dual_extruder","title":"has_dual_extruder  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>has_dual_extruder: bool = False\n</code></pre> <p>True if the printer is an H2D (Dual Extruder) architecture.</p>"},{"location":"reference/bpm/bambustate/#bpm.bambustate.PrinterCapabilities.has_lidar","title":"has_lidar  <code>class-attribute</code> <code>instance-attribute</code>","text":"Python<pre><code>has_lidar: bool = False\n</code></pre> <p>True if the printer has a LiDAR sensor (verified against xcam presence).</p>"},{"location":"reference/bpm/bambutools/","title":"bambutools","text":""},{"location":"reference/bpm/bambutools/#bpm.bambutools","title":"bambutools","text":"<p>Classes:</p> Name Description <code>AMSControlCommand</code> <p>AMS Control Commands enum</p> <code>AMSDryingStage</code> <p>Represents the operational stages of the AMS2 drying cycle.</p> <code>AMSModel</code> <p>AMS model enum</p> <code>AMSSeries</code> <p>AMS Series enum</p> <code>AMSUserSetting</code> <p>AMS User Settings enum</p> <code>ActiveTool</code> <p>The currently active extruder index.</p> <code>ExtruderInfoState</code> <p>Consolidated logical states for extruder sensor status.</p> <code>ExtruderStatus</code> <p>Operational states for physical extruders.</p> <code>NozzleDiameter</code> <p>Nozzle Diameter enum</p> <code>NozzleType</code> <p>Nozzle Type enum</p> <code>PlateType</code> <p>Used by <code>BambuPrinter.print_3mf_file</code> to specify which plate should be used when</p> <code>PrintOption</code> <p>Print Option enum</p> <code>PrinterModel</code> <p>Printer model enum</p> <code>PrinterSeries</code> <p>Printer Series enum</p> <code>ServiceState</code> <p>This enum is used by <code>bambu-printer-manager</code> to track the underlying state</p> <code>TrayState</code> <p>Operational status of the filament tray.</p> <p>Functions:</p> Name Description <code>decodeError</code> <p>Decodes a raw print_error integer into a full HMS dictionary.</p> <code>decodeHMS</code> <p>Decodes the raw HMS list from telemetry into a structured list of dictionaries.</p> <code>getAMSModelBySerial</code> <p>Returns the hardware model based on the serial number prefix.</p> <code>getAMSSeriesByModel</code> <p>Returns the AMS series enum based on the provided model.</p> <code>getModelBySerial</code> <code>getPrinterModelBySerial</code> <p>Returns the Printer model enum based on the provided serial #.</p> <code>getPrinterSeriesByModel</code> <p>Returns the Printer series enum based on the provided model.</p> <code>getSeriesByModel</code> <code>parseAMSInfo</code> <p>Parses decimal bit-packed AMS info for status and feature reconciliation.</p> <code>parseAMSStatus</code> <p>Maps the ams_status code to human-readable descriptions.</p> <code>parseExtruderInfo</code> <p>Decodes the extruder 'info' bit-packed status using unique ExtruderInfoState names.</p> <code>parseExtruderStatus</code> <p>Decodes the operational extruder state using the exhaustive Enum map.</p> <code>parseFan</code> <p>Mainly an internal method used for parsing Fan data</p> <code>parseRFIDStatus</code> <p>Can be used to parse <code>ams_rfid_status</code></p> <code>parseStage</code> <p>Maps stg_cur numeric codes to human-readable print stages.</p> <code>scaleFanSpeed</code> <p>Scales proprietary 0-15 fan speed values to a 0-100 percentage.</p> <code>sortFileTreeAlphabetically</code> <p>Sorts a dict of file/directory nodes hierarchically in case-insensitive</p> <code>unpackTemperature</code> <p>Unpacks a 32-bit packed temperature integer into a tuple of (Actual, Target).</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.AMSControlCommand","title":"AMSControlCommand","text":"<p>               Bases: <code>Enum</code></p> <p>AMS Control Commands enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.AMSDryingStage","title":"AMSDryingStage","text":"<p>               Bases: <code>IntEnum</code></p> <p>Represents the operational stages of the AMS2 drying cycle. Resolved from heater, vent, and fan bitmasks.</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.AMSModel","title":"AMSModel","text":"<p>               Bases: <code>Enum</code></p> <p>AMS model enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.AMSSeries","title":"AMSSeries","text":"<p>               Bases: <code>Enum</code></p> <p>AMS Series enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.AMSUserSetting","title":"AMSUserSetting","text":"<p>               Bases: <code>Enum</code></p> <p>AMS User Settings enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.ActiveTool","title":"ActiveTool","text":"<p>               Bases: <code>IntEnum</code></p> <p>The currently active extruder index.</p> <ul> <li><code>SINGLE_EXTRUDER (-1)</code>: Standard single-toolhead architecture (X1/P1/A1).</li> <li><code>RIGHT_EXTRUDER (0)</code>: The primary/right toolhead in H2D (Dual Extruder) systems.</li> <li><code>LEFT_EXTRUDER (1)</code>: The secondary/left toolhead in H2D (Dual Extruder) systems.</li> <li><code>NOT_ACTIVE (15)</code>: The multi-extruder system is in a transitonal state.</li> </ul>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.ExtruderInfoState","title":"ExtruderInfoState","text":"<p>               Bases: <code>IntEnum</code></p> <p>Consolidated logical states for extruder sensor status. Values represent unique state IDs to prevent bitmask collisions.</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.ExtruderStatus","title":"ExtruderStatus","text":"<p>               Bases: <code>IntEnum</code></p> <p>Operational states for physical extruders. Values are mapped directly from the Bambu Studio source code (BBL_EXTRUDER_STATE).</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.NozzleDiameter","title":"NozzleDiameter","text":"<p>               Bases: <code>Enum</code></p> <p>Nozzle Diameter enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.NozzleType","title":"NozzleType","text":"<p>               Bases: <code>Enum</code></p> <p>Nozzle Type enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.PlateType","title":"PlateType","text":"<p>               Bases: <code>Enum</code></p> <p>Used by <code>BambuPrinter.print_3mf_file</code> to specify which plate should be used when starting a print job.</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.PrintOption","title":"PrintOption","text":"<p>               Bases: <code>Enum</code></p> <p>Print Option enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.PrinterModel","title":"PrinterModel","text":"<p>               Bases: <code>Enum</code></p> <p>Printer model enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.PrinterSeries","title":"PrinterSeries","text":"<p>               Bases: <code>Enum</code></p> <p>Printer Series enum</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.ServiceState","title":"ServiceState","text":"<p>               Bases: <code>Enum</code></p> <p>This enum is used by <code>bambu-printer-manager</code> to track the underlying state of the <code>mqtt</code> connection to the printer.</p>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.ServiceState--states","title":"States","text":"<ul> <li><code>NO_STATE</code> - Startup / initial state indicates no active session.</li> <li><code>CONNECTED</code> - Primary state expected when polling <code>BambuPrinter</code>.</li> <li><code>PAUSED</code> - <code>bambu-printer</code>'s session state is paused.</li> <li><code>QUIT</code> - When this state is triggered, all session based resources and threads are released.</li> </ul>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.TrayState","title":"TrayState","text":"<p>               Bases: <code>IntEnum</code></p> <p>Operational status of the filament tray.</p> <ul> <li><code>UNLOADED (0)</code>: No filament detected in the toolhead path.</li> <li><code>LOADED (1)</code>: Filament is fully loaded into the toolhead.</li> <li><code>LOADING (2)</code>: Filament is currently being fed to the toolhead.</li> <li><code>UNLOADING (3)</code>: Filament is currently being retracted from the toolhead.</li> </ul>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.decodeError","title":"decodeError","text":"Python<pre><code>decodeError(error: int) -&gt; dict\n</code></pre> <p>Decodes a raw print_error integer into a full HMS dictionary. Uses nibble-swapping to find the message but preserves the original module ID and code context in the result.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>def decodeError(error: int) -&gt; dict:\n    \"\"\"\n    Decodes a raw print_error integer into a full HMS dictionary.\n    Uses nibble-swapping to find the message but preserves the original\n    module ID and code context in the result.\n    \"\"\"\n    if error == 0:\n        return {}\n\n    raw_hex = f\"{error:08X}\".upper()\n\n    # Base Metadata (using the ORIGINAL error code)\n    wiki_slug = \"_\".join(raw_hex[i : i + 4] for i in range(0, 8, 4))\n    res = {\n        \"code\": f\"HMS_{wiki_slug}\",\n        \"msg\": \"Unknown HMS Error\",\n        \"module\": \"System\",\n        \"severity\": \"Error\",\n        \"is_critical\": False,\n        \"type\": \"device_error\",\n        \"url\": \"https://wiki.bambulab.com/en/hms/error-code\",\n    }\n\n    # Map Original Module Name (based on original error bits)\n    real_module = (error &gt;&gt; 24) &amp; 0xFF\n\n    modules = [\"03\", \"05\", \"07\", \"0B\", \"0C\", \"10\", \"12\"]\n    module_map = {\n        0x03: \"Mainboard\",\n        0x05: \"AMS\",\n        0x12: \"AMS\",\n        0x07: \"Toolhead\",\n        0x0B: \"Webcam\",\n        0x10: \"HMS\",\n    }\n    res[\"module\"] = module_map.get(real_module, \"System\")\n\n    msg_list = HMS_STATUS.get(\"data\", {}).get(\"device_error\", {}).get(\"en\", [])\n\n    # lets put our module at the top\n    if raw_hex[:2] in modules:\n        modules.remove(raw_hex[:2])\n    modules.insert(0, raw_hex[:2])\n\n    for module in modules:\n        # Swap the first nibble to try and find a match in the dictionary\n        current_hex = f\"{module}{raw_hex[2:]}\"\n\n        for entry in msg_list:\n            if entry.get(\"ecode\", \"\").upper() == current_hex.upper():\n                res[\"msg\"] = entry.get(\"intro\", res[\"msg\"])\n                break\n\n        if res[\"msg\"] != \"Unknown HMS Error\":\n            break\n\n    # Severity and Criticality Mapping (0xSS byte)\n    mask = (error &gt;&gt; 16) &amp; 0xFF\n    if mask in (0x00, 0x01):\n        # 00 = Fatal, 01 = Error. Both are critical blockers.\n        res[\"severity\"] = \"Fatal\" if mask == 0x00 else \"Error\"\n        res[\"is_critical\"] = True\n    elif mask == 0x02:\n        res[\"severity\"] = \"Warning\"\n        res[\"is_critical\"] = False\n    else:\n        res[\"severity\"] = \"Info\"\n        res[\"is_critical\"] = False\n\n    return res\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.decodeHMS","title":"decodeHMS","text":"Python<pre><code>decodeHMS(hms_list: list) -&gt; list[dict]\n</code></pre> <p>Decodes the raw HMS list from telemetry into a structured list of dictionaries. Reverts to the stable baseline prior to print_error integration.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>def decodeHMS(hms_list: list) -&gt; list[dict]:\n    \"\"\"\n    Decodes the raw HMS list from telemetry into a structured list of dictionaries.\n    Reverts to the stable baseline prior to print_error integration.\n    \"\"\"\n    decoded_errors = []\n\n    for item in hms_list:\n        # Persistence check: If already decoded, keep as-is\n        if isinstance(item, dict) and isinstance(item.get(\"code\"), str):\n            decoded_errors.append(item)\n            continue\n\n        try:\n            attr = int(item.get(\"attr\", 0))\n            code = int(item.get(\"code\", 0))\n        except (AttributeError, ValueError, TypeError):\n            continue\n\n        if attr == 0:\n            continue\n\n        # Construct ecode and wiki slug\n        ecode = f\"{attr:08X}{code:08X}\"\n        wiki_slug = \"_\".join(ecode[i : i + 4] for i in range(0, 16, 4))\n\n        res = {\n            \"code\": f\"HMS_{wiki_slug}\",\n            \"msg\": \"Unknown HMS Error\",\n            \"module\": \"System\",\n            \"severity\": \"Error\",\n            \"is_critical\": False,\n            \"type\": \"device_hms\",\n            \"url\": f\"https://wiki.bambulab.com/en/x1/troubleshooting/hmscode/{wiki_slug}\",\n        }\n\n        # Module and Severity parsing (0xMMSSQECC)\n        mid = (attr &gt;&gt; 24) &amp; 0xFF\n        mask = (attr &gt;&gt; 16) &amp; 0xFF\n        module_map = {\n            0x03: \"Mainboard\",\n            0x05: \"AMS\",\n            0x12: \"AMS\",\n            0x07: \"Toolhead\",\n            0x0B: \"Webcam\",\n            0x10: \"HMS\",\n        }\n        res[\"module\"] = module_map.get(mid, \"System\")\n\n        # Dictionary Lookup (Search device_hms only)\n        msg_list = HMS_STATUS.get(\"data\", {}).get(\"device_hms\", {}).get(\"en\", [])\n        for entry in msg_list:\n            if entry.get(\"ecode\", \"\").upper() == ecode:\n                res[\"msg\"] = entry.get(\"intro\", res[\"msg\"])\n                break\n\n        # Severity Mapping\n        if mask in (0x00, 0x01):\n            res[\"severity\"], res[\"is_critical\"] = (\n                (\"Fatal\" if mask == 0x00 else \"Error\"),\n                True,\n            )\n        elif mask == 0x02:\n            res[\"severity\"] = \"Warning\"\n        else:\n            res[\"severity\"] = \"Info\"\n\n        decoded_errors.append(res)\n\n    return decoded_errors\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.getAMSModelBySerial","title":"getAMSModelBySerial","text":"Python<pre><code>getAMSModelBySerial(serial: str) -&gt; AMSModel\n</code></pre> <p>Returns the hardware model based on the serial number prefix.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>def getAMSModelBySerial(serial: str) -&gt; AMSModel:\n    \"\"\"\n    Returns the hardware model based on the serial number prefix.\n    \"\"\"\n    prefix = serial[:3].upper()\n\n    if prefix == \"19C\":\n        return AMSModel.AMS_2_PRO\n    if prefix == \"19F\":\n        return AMSModel.AMS_HT\n    if prefix == \"006\":\n        return AMSModel.AMS_1\n    if prefix == \"03C\":\n        return AMSModel.AMS_LITE\n    return AMSModel.UNKNOWN\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.getAMSSeriesByModel","title":"getAMSSeriesByModel  <code>staticmethod</code>","text":"Python<pre><code>getAMSSeriesByModel(model: AMSModel) -&gt; AMSSeries\n</code></pre> <p>Returns the AMS series enum based on the provided model.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\ndef getAMSSeriesByModel(model: AMSModel) -&gt; AMSSeries:\n    \"\"\"\n    Returns the AMS series enum based on the provided model.\n    \"\"\"\n\n    if model in (AMSModel.AMS_1, AMSModel.AMS_LITE):\n        return AMSSeries.GEN_1\n    if model in (AMSModel.AMS_HT, AMSModel.AMS_2_PRO):\n        return AMSSeries.GEN_2\n    return AMSSeries.UNKNOWN\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.getModelBySerial","title":"getModelBySerial  <code>deprecated</code>","text":"Python<pre><code>getModelBySerial(serial: str) -&gt; PrinterModel\n</code></pre> Deprecated <p>This method is deprecated (v1.0.0). Use <code>getPrinterModelBySerial</code>.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@deprecated(\"This method is deprecated (v1.0.0). Use `getPrinterModelBySerial`.\")\ndef getModelBySerial(serial: str) -&gt; PrinterModel:\n    return getPrinterModelBySerial(serial)\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.getPrinterModelBySerial","title":"getPrinterModelBySerial","text":"Python<pre><code>getPrinterModelBySerial(serial: str) -&gt; PrinterModel\n</code></pre> <p>Returns the Printer model enum based on the provided serial #.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>def getPrinterModelBySerial(serial: str) -&gt; PrinterModel:\n    \"\"\"\n    Returns the Printer model enum based on the provided serial #.\n    \"\"\"\n    if serial.startswith(\"00M\"):\n        return PrinterModel.X1C\n    elif serial.startswith(\"00W\"):\n        return PrinterModel.X1\n    elif serial.startswith(\"03W\"):\n        return PrinterModel.X1E\n    elif serial.startswith(\"01S\"):\n        return PrinterModel.P1P\n    elif serial.startswith(\"01P\"):\n        return PrinterModel.P1S\n    elif serial.startswith(\"030\"):\n        return PrinterModel.A1_MINI\n    elif serial.startswith(\"039\"):\n        return PrinterModel.A1\n    elif serial.startswith(\"22E\"):\n        return PrinterModel.P2S\n    elif serial.startswith(\"093\"):\n        return PrinterModel.H2S\n    elif serial.startswith(\"094\"):\n        return PrinterModel.H2D\n    else:\n        return PrinterModel.UNKNOWN\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.getPrinterSeriesByModel","title":"getPrinterSeriesByModel  <code>staticmethod</code>","text":"Python<pre><code>getPrinterSeriesByModel(model: PrinterModel) -&gt; PrinterSeries\n</code></pre> <p>Returns the Printer series enum based on the provided model.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\ndef getPrinterSeriesByModel(model: PrinterModel) -&gt; PrinterSeries:\n    \"\"\"\n    Returns the Printer series enum based on the provided model.\n    \"\"\"\n    try:\n        return PrinterSeries[model.name[:2]]\n    except (KeyError, AttributeError):\n        return PrinterSeries.UNKNOWN\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.getSeriesByModel","title":"getSeriesByModel  <code>deprecated</code> <code>staticmethod</code>","text":"Python<pre><code>getSeriesByModel(model: PrinterModel) -&gt; PrinterSeries\n</code></pre> Deprecated <p>This method is deprecated (v1.0.0). Use <code>getPrinterSeriesByModel</code>.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\n@deprecated(\"This method is deprecated (v1.0.0). Use `getPrinterSeriesByModel`.\")\ndef getSeriesByModel(model: PrinterModel) -&gt; PrinterSeries:\n    return getPrinterSeriesByModel(model)\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.parseAMSInfo","title":"parseAMSInfo  <code>staticmethod</code>","text":"Python<pre><code>parseAMSInfo(info_int: int) -&gt; dict\n</code></pre> <p>Parses decimal bit-packed AMS info for status and feature reconciliation. Reconciled against Bambu Studio source logic for H2D/X1/P1 hardware.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\ndef parseAMSInfo(info_int: int) -&gt; dict:\n    \"\"\"\n    Parses decimal bit-packed AMS info for status and feature reconciliation.\n    Reconciled against Bambu Studio source logic for H2D/X1/P1 hardware.\n    \"\"\"\n    return {\n        \"is_powered\": bool(info_int &amp; 1),\n        \"is_online\": bool(info_int &amp; 2),\n        \"rfid_ready\": bool(info_int &amp; 4),\n        \"hub_sensor_triggered\": bool(info_int &amp; 8),\n        \"circ_fan_on\": bool(info_int &amp; 16),\n        \"h2d_toolhead_index\": (info_int &gt;&gt; 5) &amp; 0x1,\n        \"exhaust_fan_on\": bool(info_int &amp; 64),\n        \"humidity_sensor_ok\": bool((info_int &amp; 128) or (info_int &amp; 131072)),\n        \"heater_on\": bool(info_int &amp; 256),\n        \"motor_running\": bool(info_int &amp; 512),\n        \"is_rotating\": bool(info_int &amp; 1024),  # Specific to AMS Drying Rotation\n        \"venting_active\": bool(info_int &amp; 2048),\n        \"high_power_mode\": bool(info_int &amp; 8192),\n        \"hardware_fault\": bool((info_int &amp; 4096) or (info_int &amp; 16384)),\n    }\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.parseAMSStatus","title":"parseAMSStatus  <code>staticmethod</code>","text":"Python<pre><code>parseAMSStatus(status_int: int) -&gt; str\n</code></pre> <p>Maps the ams_status code to human-readable descriptions. Definitive mapping reconciled against Bambu Studio source code.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\ndef parseAMSStatus(status_int: int) -&gt; str:\n    \"\"\"\n    Maps the ams_status code to human-readable descriptions.\n    Definitive mapping reconciled against Bambu Studio source code.\n    \"\"\"\n    # The high byte represents the primary operational state\n    main_status = (status_int &gt;&gt; 8) &amp; 0xFF\n\n    status_map = {\n        0x00: \"Idle\",  # BBL_AMS_STATUS_IDLE\n        0x01: \"Filament Changing\",  # BBL_AMS_STATUS_FILAMENT_CHANGE\n        0x02: \"RFID Identifying\",  # BBL_AMS_STATUS_RFID_READING\n        0x03: \"Assist/Engaged\",  # BBL_AMS_STATUS_ASSIST (Feed Assist)\n        0x04: \"Calibration\",  # BBL_AMS_STATUS_CALIBRATION\n        0x10: \"Self Check\",  # BBL_AMS_STATUS_SELF_CHECK\n        0x20: \"Debug\",  # BBL_AMS_STATUS_DEBUG\n        0xFF: \"Unknown\",  # BBL_AMS_STATUS_UNKNOWN\n    }\n\n    # Audit Note: In H2D telemetry (e.g., 768 / 0x0300),\n    # the 0x03 high byte correctly resolves to \"Assist/Engaged\".\n    return status_map.get(main_status, \"Idle\")\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.parseExtruderInfo","title":"parseExtruderInfo  <code>staticmethod</code>","text":"Python<pre><code>parseExtruderInfo(info_int: int) -&gt; ExtruderInfoState\n</code></pre> <p>Decodes the extruder 'info' bit-packed status using unique ExtruderInfoState names. Bitmask logic (0x02, 0x04, 0x08) is reconciled against Bambu Studio source.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\ndef parseExtruderInfo(info_int: int) -&gt; ExtruderInfoState:\n    \"\"\"\n    Decodes the extruder 'info' bit-packed status using unique ExtruderInfoState names.\n    Bitmask logic (0x02, 0x04, 0x08) is reconciled against Bambu Studio source.\n    \"\"\"\n    # 1. Hardware Interlock: Bit 3 (0x08) presence is mandatory for nozzle detection.\n    if not (info_int &amp; 0x08):\n        return ExtruderInfoState.NO_NOZZLE\n\n    # 2. Downstream Precedence: Bit 1 (0x02) indicates filament at the toolhead gears.\n    if info_int &amp; 0x02:\n        return ExtruderInfoState.LOADED\n\n    # 3. Upstream State: Bit 2 (0x04) indicates filament is only at the buffer/hub.\n    if info_int &amp; 0x04:\n        return ExtruderInfoState.BUFFER_LOADED\n\n    # 4. Default: Nozzle detected (Bit 3 is high), but no filament in the path.\n    return ExtruderInfoState.EMPTY\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.parseExtruderStatus","title":"parseExtruderStatus  <code>staticmethod</code>","text":"Python<pre><code>parseExtruderStatus(stat_int: int) -&gt; ExtruderStatus\n</code></pre> <p>Decodes the operational extruder state using the exhaustive Enum map. Definitive mapping reconciled against Bambu Studio source.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\ndef parseExtruderStatus(stat_int: int) -&gt; ExtruderStatus:\n    \"\"\"\n    Decodes the operational extruder state using the exhaustive Enum map.\n    Definitive mapping reconciled against Bambu Studio source.\n    \"\"\"\n    # 1. Operational Precedence:\n    # The 'working bits' at 8-9 (0x0300) are the primary indicators of\n    # the extruder's mechanical state machine.\n    working_bits = (stat_int &gt;&gt; 8) &amp; 0x03\n\n    # Check for the rare SUCCESS state (3)\n    if working_bits == 0x03:\n        return ExtruderStatus.ACTIVE\n    elif working_bits == 0x02:\n        # In the source, 0x02 is sometimes used for specific transitions,\n        # but 0x03 is the official 'Working' flag.\n        return ExtruderStatus.ACTIVE\n\n    # 2. Thermal State:\n    # Bit 0 (0x01) is the official 'Heater Active' flag in the stat register.\n    if stat_int &amp; 0x01:\n        return ExtruderStatus.HEATING\n\n    # 3. Default: The toolhead is in a standby or idle state.\n    return ExtruderStatus.IDLE\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.parseFan","title":"parseFan  <code>deprecated</code> <code>staticmethod</code>","text":"Python<pre><code>parseFan(fan: int) -&gt; int\n</code></pre> Deprecated <p>This property is deprecated (v1.0.0). Use <code>scaleFanSpeed</code>.</p> <p>Mainly an internal method used for parsing Fan data</p> <p>Deprecated</p> <p>This property is deprecated (v1.0.0). Use <code>scaleFanSpeed</code>.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\n@deprecated(\"This property is deprecated (v1.0.0). Use `scaleFanSpeed`.\")\ndef parseFan(fan: int) -&gt; int:\n    \"\"\"\n    Mainly an internal method used for parsing Fan data\n    !!! danger \"Deprecated\"\n    This property is deprecated (v1.0.0). Use `scaleFanSpeed`.\n    \"\"\"\n    fan = int(fan)\n    if fan == 1:\n        return 10\n    elif fan == 2:\n        return 20\n    elif fan in (3, 4):\n        return 30\n    elif fan in (5, 6):\n        return 40\n    elif fan in (7, 8):\n        return 50\n    elif fan == 9:\n        return 60\n    elif fan in (10, 11):\n        return 70\n    elif fan == 12:\n        return 80\n    elif fan in (13, 14):\n        return 90\n    elif fan == 15:\n        return 100\n    return 0\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.parseRFIDStatus","title":"parseRFIDStatus  <code>staticmethod</code>","text":"Python<pre><code>parseRFIDStatus(status)\n</code></pre> <p>Can be used to parse <code>ams_rfid_status</code></p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\ndef parseRFIDStatus(status):\n    \"\"\"\n    Can be used to parse `ams_rfid_status`\n    \"\"\"\n    if status == 0:\n        return \"RFID Idle\"\n    elif status == 1:\n        return \"RFID Reading\"\n    elif status == 2:\n        return \"GCode Translating\"\n    elif status == 3:\n        return \"GCode Running\"\n    elif status == 4:\n        return \"RFID Assistant\"\n    elif status == 5:\n        return \"Switch Filament\"\n    elif status == 6:\n        return \"Has Filament\"\n    else:\n        return \"Unknown\"\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.parseStage","title":"parseStage  <code>staticmethod</code>","text":"Python<pre><code>parseStage(stage_int: int) -&gt; str\n</code></pre> <p>Maps stg_cur numeric codes to human-readable print stages. Definitive mapping reconciled against Bambu Studio's internal string tables.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>@staticmethod\ndef parseStage(stage_int: int) -&gt; str:\n    \"\"\"\n    Maps stg_cur numeric codes to human-readable print stages.\n    Definitive mapping reconciled against Bambu Studio's internal string tables.\n    \"\"\"\n    stage_map = {\n        -1: \"\",\n        0: \"\",  # BBL_STG_IDLE\n        1: \"Auto bed leveling\",  # BBL_STG_ABL\n        2: \"Heatbed preheating\",  # BBL_STG_BED_PREHEAT\n        3: \"Sweeping XY mech mode\",  # BBL_STG_XY_SWEEP\n        4: \"Changing filament\",  # BBL_STG_FILAMENT_CHANGE\n        5: \"M400 pause\",  # BBL_STG_M400_PAUSE\n        6: \"Paused due to filament runout\",  # BBL_STG_RUNOUT_PAUSE\n        7: \"Heating hotend\",  # BBL_STG_HOTEND_HEATING\n        8: \"Calibrating extrusion\",  # BBL_STG_EXTRUSION_CALI\n        9: \"Scanning bed surface\",  # BBL_STG_BED_SCAN\n        10: \"Inspecting first layer\",  # BBL_STG_FIRST_LAYER_INSPECT\n        11: \"Identifying build plate type\",  # BBL_STG_PLATE_IDENTIFY\n        12: \"Calibrating Micro Lidar\",  # BBL_STG_LIDAR_CALI\n        13: \"Homing toolhead\",  # BBL_STG_HOMING\n        14: \"Cleaning nozzle tip\",  # BBL_STG_NOZZLE_CLEAN\n        15: \"Checking extruder temperature\",  # BBL_STG_EXTRUDER_TEMP_CHECK\n        16: \"Printing was paused by the user\",  # BBL_STG_USER_PAUSE\n        17: \"Pause of front cover falling\",  # BBL_STG_COVER_PAUSE\n        18: \"Calibrating the micro lidar\",  # BBL_STG_LIDAR_CALI_2\n        19: \"Calibrating extrusion flow\",  # BBL_STG_FLOW_CALI\n        20: \"Paused due to nozzle temperature malfunction\",  # BBL_STG_NOZZLE_TEMP_PAUSE\n        21: \"Paused due to heat bed temperature malfunction\",  # BBL_STG_BED_TEMP_PAUSE\n        22: \"Filament unloading\",  # BBL_STG_FILAMENT_UNLOAD\n        23: \"Skip step pause\",  # BBL_STG_SKIP_STEP_PAUSE\n        24: \"Filament loading\",  # BBL_STG_FILAMENT_LOAD\n        25: \"Motor noise calibration\",  # BBL_STG_MOTOR_CALI\n        26: \"Paused due to AMS lost\",  # BBL_STG_AMS_LOST_PAUSE\n        27: \"Paused due to low speed of the heat break fan\",  # BBL_STG_FAN_PAUSE\n        28: \"Paused due to chamber temperature control error\",  # BBL_STG_CHAMBER_PAUSE\n        29: \"Cooling chamber\",  # BBL_STG_CHAMBER_COOLING\n        30: \"Paused by the Gcode inserted by user\",  # BBL_STG_GCODE_PAUSE\n        31: \"Motor noise showoff\",  # BBL_STG_MOTOR_SHOWOFF\n        32: \"Nozzle filament covered detected pause\",  # BBL_STG_NOZZLE_COVER_PAUSE\n        33: \"Cutter error pause\",  # BBL_STG_CUTTER_PAUSE\n        34: \"First layer error pause\",  # BBL_STG_FIRST_LAYER_PAUSE\n        35: \"Nozzle clog pause\",  # BBL_STG_NOZZLE_CLOG_PAUSE\n        255: \"\",\n    }\n    return stage_map.get(stage_int, f\"Stage [{stage_int}]\")\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.scaleFanSpeed","title":"scaleFanSpeed","text":"Python<pre><code>scaleFanSpeed(raw_val: Any) -&gt; int\n</code></pre> <p>Scales proprietary 0-15 fan speed values to a 0-100 percentage.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>def scaleFanSpeed(raw_val: Any) -&gt; int:\n    \"\"\"\n    Scales proprietary 0-15 fan speed values to a 0-100 percentage.\n    \"\"\"\n    try:\n        val = int(raw_val)\n        return min(max(round((val / 15.0) * 100), 0), 100)\n    except Exception:\n        return 0\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.sortFileTreeAlphabetically","title":"sortFileTreeAlphabetically","text":"Python<pre><code>sortFileTreeAlphabetically(source) -&gt; dict\n</code></pre> <p>Sorts a dict of file/directory nodes hierarchically in case-insensitive alphabetical order (ascending).</p> <p>Parameters:</p> Name Type Description Default <code>dict</code> <p>A dict of lists representing files and/or directories.</p> required <p>Returns:</p> Name Type Description <code>dict</code> <code>dict</code> <p>The sorted dict of lists.</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>def sortFileTreeAlphabetically(source) -&gt; dict:\n    \"\"\"\n    Sorts a dict of file/directory nodes hierarchically in case-insensitive\n    alphabetical order (ascending).\n\n    Args:\n        source (dict): A dict of lists representing files and/or directories.\n\n    Returns:\n        dict: The sorted dict of lists.\n    \"\"\"\n\n    def sort_node_list(node_list):\n        for item in node_list:\n            if item.get(\"id\", \"\").endswith(\"/\") and \"children\" in item:\n                item[\"children\"] = sort_node_list(item[\"children\"])\n\n        def sort_key(item):\n            return (not item.get(\"id\", \"\").endswith(\"/\"), item.get(\"name\", \"\").lower())\n\n        return sorted(node_list, key=sort_key)\n\n    source[\"children\"] = sort_node_list(source[\"children\"])\n    return source\n</code></pre>"},{"location":"reference/bpm/bambutools/#bpm.bambutools.sortFileTreeAlphabetically(source)","title":"<code>source</code>","text":""},{"location":"reference/bpm/bambutools/#bpm.bambutools.unpackTemperature","title":"unpackTemperature","text":"Python<pre><code>unpackTemperature(raw_temp: int) -&gt; tuple[float, float]\n</code></pre> <p>Unpacks a 32-bit packed temperature integer into a tuple of (Actual, Target).</p> Source code in <code>src/bpm/bambutools.py</code> Python<pre><code>def unpackTemperature(raw_temp: int) -&gt; tuple[float, float]:\n    \"\"\"\n    Unpacks a 32-bit packed temperature integer into a tuple of (Actual, Target).\n    \"\"\"\n    return float(raw_temp &amp; 0xFFFF), float((raw_temp &gt;&gt; 16) &amp; 0xFFFF)\n</code></pre>"},{"location":"reference/bpm/ftpsclient/__init__/","title":"ftpsclient","text":""},{"location":"reference/bpm/ftpsclient/__init__/#bpm.ftpsclient","title":"ftpsclient","text":"<p>Modules:</p> Name Description <code>ftpsclient</code> <p>Based on: https://github.com/dgonzo27/py-iot-utils</p>"},{"location":"reference/bpm/ftpsclient/ftpsclient/","title":"ftpsclient","text":""},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient","title":"ftpsclient","text":"<p>Based on: https://github.com/dgonzo27/py-iot-utils</p> <p>MIT License</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p> <p>wrapper for FTPS server interactions</p> <p>Classes:</p> Name Description <code>ImplicitTLS</code> <p>ftplib.FTP_TLS sub-class to support implicit SSL FTPS</p> <code>IoTFTPSClient</code> <p>iot ftps ftpsclient</p>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.ImplicitTLS","title":"ImplicitTLS","text":"Python<pre><code>ImplicitTLS(*args, **kwargs)\n</code></pre> <p>               Bases: <code>FTP_TLS</code></p> <p>ftplib.FTP_TLS sub-class to support implicit SSL FTPS</p> <p>Attributes:</p> Name Type Description <code>sock</code> <p>return socket</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def __init__(self, *args, **kwargs):\n    super().__init__(*args, **kwargs)\n    self._sock = None\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.ImplicitTLS.sock","title":"sock  <code>property</code> <code>writable</code>","text":"Python<pre><code>sock\n</code></pre> <p>return socket</p>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient","title":"IoTFTPSClient","text":"Python<pre><code>IoTFTPSClient(\n    ftps_host: str,\n    ftps_port: int | None = 21,\n    ftps_user: str | None = \"\",\n    ftps_pass: str | None = \"\",\n    ssl_implicit: bool | None = False,\n)\n</code></pre> <p>iot ftps ftpsclient</p> <p>Methods:</p> Name Description <code>delete_file</code> <p>delete a file from under a path inside the FTPS server</p> <code>delete_folder</code> <p>delete a folder inside the FTPS server</p> <code>disconnect</code> <p>disconnect the current session from the ftps server</p> <code>download_file</code> <p>download a file to a path on the local filesystem</p> <code>instantiate_ftps_session</code> <p>init ftps_session based on input params</p> <code>list_files</code> <p>list files under a path inside the FTPS server</p> <code>list_files_ex</code> <p>list files under a path inside the FTPS server</p> <code>move_file</code> <p>move a file inside the FTPS server to another path inside the FTPS server</p> <code>upload_file</code> <p>upload a file to a path inside the FTPS server</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def __init__(\n    self,\n    ftps_host: str,\n    ftps_port: int | None = 21,\n    ftps_user: str | None = \"\",\n    ftps_pass: str | None = \"\",\n    ssl_implicit: bool | None = False,\n) -&gt; None:\n    self.ftps_host = ftps_host\n    self.ftps_port = ftps_port\n    self.ftps_user = ftps_user\n    self.ftps_pass = ftps_pass\n    self.ssl_implicit = ssl_implicit\n    self.instantiate_ftps_session()\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.delete_file","title":"delete_file","text":"Python<pre><code>delete_file(path: str)\n</code></pre> <p>delete a file from under a path inside the FTPS server</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def delete_file(self, path: str):\n    \"\"\"delete a file from under a path inside the FTPS server\"\"\"\n    self.ftps_session.delete(path)\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.delete_folder","title":"delete_folder","text":"Python<pre><code>delete_folder(path: str)\n</code></pre> <p>delete a folder inside the FTPS server</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def delete_folder(self, path: str):\n    \"\"\"delete a folder inside the FTPS server\"\"\"\n    self.ftps_session.rmd(path)\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.disconnect","title":"disconnect","text":"Python<pre><code>disconnect() -&gt; None\n</code></pre> <p>disconnect the current session from the ftps server</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def disconnect(self) -&gt; None:\n    \"\"\"disconnect the current session from the ftps server\"\"\"\n    self.ftps_session.close()\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.download_file","title":"download_file","text":"Python<pre><code>download_file(source: str, dest: str)\n</code></pre> <p>download a file to a path on the local filesystem</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def download_file(self, source: str, dest: str):\n    \"\"\"download a file to a path on the local filesystem\"\"\"\n    with open(dest, \"wb\") as file:\n        self.ftps_session.retrbinary(f\"RETR {source}\", file.write)\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.instantiate_ftps_session","title":"instantiate_ftps_session","text":"Python<pre><code>instantiate_ftps_session() -&gt; None\n</code></pre> <p>init ftps_session based on input params</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def instantiate_ftps_session(self) -&gt; None:\n    \"\"\"init ftps_session based on input params\"\"\"\n    self.ftps_session = ImplicitTLS() if self.ssl_implicit else ftplib.FTP()\n    self.ftps_session.set_debuglevel(0)\n\n    self.welcome = self.ftps_session.connect(\n        host=self.ftps_host, port=self.ftps_port\n    )\n\n    if self.ftps_user and self.ftps_pass:\n        self.ftps_session.login(user=self.ftps_user, passwd=self.ftps_pass)\n    else:\n        self.ftps_session.login()\n\n    if self.ssl_implicit:\n        self.ftps_session.prot_p()\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.list_files","title":"list_files","text":"Python<pre><code>list_files(path: str = '/') -&gt; None\n</code></pre> <p>list files under a path inside the FTPS server</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def list_files(self, path: str = \"/\") -&gt; None:\n    \"\"\"list files under a path inside the FTPS server\"\"\"\n    return self.ftps_session.dir(path, print)\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.list_files_ex","title":"list_files_ex","text":"Python<pre><code>list_files_ex(path: str) -&gt; list[FtpListItem] | None\n</code></pre> <p>list files under a path inside the FTPS server</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def list_files_ex(self, path: str) -&gt; list[FtpListItem] | None:\n    \"\"\"list files under a path inside the FTPS server\"\"\"\n    try:\n        f = io.StringIO()\n        with redirect_stdout(f):\n            self.ftps_session.dir(path)\n        s = f.getvalue()\n    except ftplib.error_perm:\n        # no permission for this path\n        return []\n    except Exception:\n        logger.exception(\"Unexpected exception occurred while fetching file list\")\n        return []\n\n    files = []\n    for row in s.split(\"\\n\"):\n        try:\n            if len(row) &lt;= 0:\n                continue\n\n            match = FTP_LIST_PATTERN.fullmatch(row)\n            if not match:\n                continue\n\n            month = MONTH_LOOKUP.get(match.group(\"month\"))\n            if month is None:\n                # invalid month\n                continue\n\n            if match.group(\"year\"):  # \"Nov 11 2025\"\n                date = datetime.datetime(\n                    int(match.group(\"year\")), month, int(match.group(\"day\"))\n                )\n            else:  # \"Nov 11 18:19\"\n                today = datetime.datetime.today()\n                date = datetime.datetime(\n                    today.year,\n                    month,\n                    int(match.group(\"day\")),\n                    hour=int(match.group(\"hour\")),\n                    minute=int(match.group(\"minute\")),\n                )\n\n            prefix = \"\" if path == \"/\" else path\n            name = match.group(\"name\")\n            size = int(match.group(\"size\"))\n\n            files.append(\n                FtpListItem(\n                    path=f\"{prefix}/{name}\",\n                    name=name,\n                    size=size,\n                    is_dir=match.group(\"directory\") == \"d\",\n                    timestamp=date,\n                    owner=match.group(\"owner\"),\n                    group=match.group(\"group\"),\n                    permissions=match.group(\"permissions\"),\n                )\n            )\n        except Exception:\n            logger.exception(f\"Unexpected error while parsing listing row: {row}\")\n\n    return files\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.move_file","title":"move_file","text":"Python<pre><code>move_file(source: str, dest: str)\n</code></pre> <p>move a file inside the FTPS server to another path inside the FTPS server</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def move_file(self, source: str, dest: str):\n    \"\"\"move a file inside the FTPS server to another path inside the FTPS server\"\"\"\n    self.ftps_session.rename(source, dest)\n</code></pre>"},{"location":"reference/bpm/ftpsclient/ftpsclient/#bpm.ftpsclient.ftpsclient.IoTFTPSClient.upload_file","title":"upload_file","text":"Python<pre><code>upload_file(source: str, dest: str, callback=None)\n</code></pre> <p>upload a file to a path inside the FTPS server</p> Source code in <code>src/bpm/ftpsclient/ftpsclient.py</code> Python<pre><code>def upload_file(self, source: str, dest: str, callback=None):\n    \"\"\"upload a file to a path inside the FTPS server\"\"\"\n\n    file_size = os.path.getsize(source)\n\n    block_size = max(file_size // 100, 8192)\n    rest = None\n\n    # Taken from ftplib.storbinary but with custom ssl handling\n    # due to the shitty bambu p1p ftps server TODO fix properly.\n    with open(source, \"rb\") as fp:\n        self.ftps_session.voidcmd(\"TYPE I\")\n\n        with self.ftps_session.transfercmd(f\"STOR {dest}\", rest) as conn:\n            while 1:\n                buf = fp.read(block_size)\n\n                if not buf:\n                    break\n\n                conn.sendall(buf)\n\n                if callback:\n                    callback(buf)\n\n            # shutdown ssl layer\n            if ftplib._SSLSocket is not None and isinstance(\n                conn, ftplib._SSLSocket\n            ):\n                # Yeah this is suposed to be conn.unwrap\n                # But since we operate in prot p mode\n                # we can close the connection always.\n                # This is cursed but it works.\n                if \"vsFTPd\" in self.welcome:\n                    conn.unwrap()\n                else:\n                    conn.shutdown(socket.SHUT_RDWR)\n\n        return self.ftps_session.voidresp()\n</code></pre>"}]}